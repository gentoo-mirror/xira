From 4ce5912f34257177fb3ccd640901aef2953894c7 Mon Sep 17 00:00:00 2001
From: Alexander Mikhaylenko <alexm@gnome.org>
Date: Thu, 23 Mar 2023 02:25:40 +0400
Subject: [PATCH 1/9] checkBox: Reimplement styles in CSS

Stop using SVG assets other than the actual check icon. This will help
making it recolorable.
---
 data/gnome-shell-icons.gresource.xml          |   1 +
 data/gnome-shell-theme.gresource.xml          |   6 -
 data/icons/scalable/status/check-symbolic.svg |   1 +
 data/theme/checkbox-focused.svg               |   1 -
 data/theme/checkbox-off-focused-light.svg     | 220 ------------------
 data/theme/checkbox-off-focused.svg           |   1 -
 data/theme/checkbox-off-light.svg             | 211 -----------------
 data/theme/checkbox-off.svg                   |   1 -
 data/theme/checkbox.svg                       |   1 -
 .../gnome-shell-sass/widgets/_check-box.scss  |  53 ++++-
 js/ui/checkBox.js                             |   5 +
 11 files changed, 49 insertions(+), 452 deletions(-)
 create mode 100644 data/icons/scalable/status/check-symbolic.svg
 delete mode 100644 data/theme/checkbox-focused.svg
 delete mode 100644 data/theme/checkbox-off-focused-light.svg
 delete mode 100644 data/theme/checkbox-off-focused.svg
 delete mode 100644 data/theme/checkbox-off-light.svg
 delete mode 100644 data/theme/checkbox-off.svg
 delete mode 100644 data/theme/checkbox.svg

diff --git a/data/gnome-shell-icons.gresource.xml b/data/gnome-shell-icons.gresource.xml
index fb33b22dc55..b882ba917e6 100644
--- a/data/gnome-shell-icons.gresource.xml
+++ b/data/gnome-shell-icons.gresource.xml
@@ -19,6 +19,7 @@
     <file>scalable/actions/screenshot-ui-window-symbolic.svg</file>
     <file>scalable/actions/screenshot-recorded-symbolic.svg</file>
     <file>scalable/status/background-app-ghost-symbolic.svg</file>
+    <file>scalable/status/check-symbolic.svg</file>
     <file>scalable/status/keyboard-caps-lock-symbolic.svg</file>
     <file>scalable/status/keyboard-enter-symbolic.svg</file>
     <file>scalable/status/keyboard-hide-symbolic.svg</file>
diff --git a/data/gnome-shell-theme.gresource.xml b/data/gnome-shell-theme.gresource.xml
index 24b3be8dbb7..b717e3c5b10 100644
--- a/data/gnome-shell-theme.gresource.xml
+++ b/data/gnome-shell-theme.gresource.xml
@@ -3,12 +3,6 @@
   <gresource prefix="/org/gnome/shell/theme">
     <file>calendar-today.svg</file>
     <file>calendar-today-light.svg</file>
-    <file>checkbox.svg</file>
-    <file>checkbox-focused.svg</file>
-    <file>checkbox-off-focused-light.svg</file>
-    <file>checkbox-off-focused.svg</file>
-    <file>checkbox-off-light.svg</file>
-    <file>checkbox-off.svg</file>
     <file>gnome-shell.css</file>
     <file>gnome-shell-high-contrast.css</file>
     <file>gnome-shell-start.svg</file>
diff --git a/data/icons/scalable/status/check-symbolic.svg b/data/icons/scalable/status/check-symbolic.svg
new file mode 100644
index 00000000000..27c620d499d
--- /dev/null
+++ b/data/icons/scalable/status/check-symbolic.svg
@@ -0,0 +1 @@
+<svg height="14" width="14" xmlns="http://www.w3.org/2000/svg"><g style="display:inline;opacity:1"><path style="color:#000;display:inline;fill:#bebebe;fill-opacity:1;stroke-linecap:round;-inkscape-stroke:none" d="M414.145 341.9a1.25 1.25 0 0 0-1.766.092l-5.68 6.305-2.881-2.909a1.25 1.25 0 0 0-1.766 1.77l4.743 4.768 7.442-8.262a1.25 1.25 0 0 0-.092-1.764z" transform="translate(-401 -339)"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/checkbox-focused.svg b/data/theme/checkbox-focused.svg
deleted file mode 100644
index 01eb733dca7..00000000000
--- a/data/theme/checkbox-focused.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="b"><stop offset="0" style="stop-color:#515151;stop-opacity:1"/><stop offset="1" style="stop-color:#292929;stop-opacity:1"/></linearGradient><linearGradient id="a"><stop style="stop-color:#0b2e52;stop-opacity:1" offset="0"/><stop style="stop-color:#1862af;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="c"><stop style="stop-color:#333;stop-opacity:1" offset="0"/><stop style="stop-color:#292929;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="d"><stop style="stop-color:#16191a;stop-opacity:1" offset="0"/><stop style="stop-color:#2b3133;stop-opacity:1" offset="1"/></linearGradient></defs><g transform="translate(-342.5 -521.362)"><rect rx="3" y="524.362" x="345.5" height="18" width="18" style="color:#000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#3584e4;stroke-width:6;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:.34999999;marker:none;enable-background:accumulate" ry="3"/><rect rx="3" y="524.362" x="345.5" height="18" width="18" style="color:#000;display:inline;overflow:visible;visibility:visible;fill:#3584e4;fill-opacity:1;stroke:#3584e4;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate" ry="3"/><path style="color:#000;fill:#fff;stroke-linecap:round;stroke-linejoin:round;-inkscape-stroke:none" d="M361.998 527.733a1.5 1.5 0 0 0-2.117.127l-6.928 7.824-2.928-2.882a1.5 1.5 0 0 0-2.12.015 1.5 1.5 0 0 0 .015 2.121l4.055 3.993a1.5 1.5 0 0 0 2.175-.075l7.975-9.006a1.5 1.5 0 0 0-.127-2.117z"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/checkbox-off-focused-light.svg b/data/theme/checkbox-off-focused-light.svg
deleted file mode 100644
index 47673776dd1..00000000000
--- a/data/theme/checkbox-off-focused-light.svg
+++ /dev/null
@@ -1,220 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   width="24"
-   height="24"
-   id="svg3199"
-   version="1.1"
-   inkscape:version="1.1.1 (3bf5ae0d25, 2021-09-20)"
-   sodipodi:docname="checkbox-off-focused-dark.svg"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:xlink="http://www.w3.org/1999/xlink"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:dc="http://purl.org/dc/elements/1.1/">
-  <defs
-     id="defs3201">
-    <linearGradient
-       id="linearGradient15404"
-       inkscape:collect="always">
-      <stop
-         id="stop15406"
-         offset="0"
-         style="stop-color:#515151;stop-opacity:1" />
-      <stop
-         id="stop15408"
-         offset="1"
-         style="stop-color:#292929;stop-opacity:1" />
-    </linearGradient>
-    <inkscape:perspective
-       sodipodi:type="inkscape:persp3d"
-       inkscape:vp_x="0 : 528.18109 : 1"
-       inkscape:vp_y="0 : 1000 : 0"
-       inkscape:vp_z="744.09448 : 528.18109 : 1"
-       inkscape:persp3d-origin="372.04724 : 352.78739 : 1"
-       id="perspective3207" />
-    <inkscape:perspective
-       id="perspective3187"
-       inkscape:persp3d-origin="0.5 : 2.3333333 : 1"
-       inkscape:vp_z="1 : 2.5 : 1"
-       inkscape:vp_y="0 : 1000 : 0"
-       inkscape:vp_x="0 : 2.5 : 1"
-       sodipodi:type="inkscape:persp3d" />
-    <linearGradient
-       inkscape:collect="always"
-       xlink:href="#linearGradient5872-5-1"
-       id="linearGradient5891-0-4"
-       gradientUnits="userSpaceOnUse"
-       x1="205.84143"
-       y1="246.7094"
-       x2="206.74803"
-       y2="231.24142" />
-    <linearGradient
-       inkscape:collect="always"
-       id="linearGradient5872-5-1">
-      <stop
-         style="stop-color:#0b2e52;stop-opacity:1"
-         offset="0"
-         id="stop5874-4-4" />
-      <stop
-         style="stop-color:#1862af;stop-opacity:1"
-         offset="1"
-         id="stop5876-0-5" />
-    </linearGradient>
-    <inkscape:path-effect
-       effect="spiro"
-       id="path-effect5837-4-6"
-       is_visible="true"
-       lpeversion="0" />
-    <inkscape:path-effect
-       effect="spiro"
-       id="path-effect14768"
-       is_visible="true"
-       lpeversion="0" />
-    <inkscape:path-effect
-       effect="spiro"
-       id="path-effect5884-4-7"
-       is_visible="true"
-       lpeversion="0" />
-    <linearGradient
-       y2="-388.72955"
-       x2="-93.031357"
-       y1="-396.34738"
-       x1="-93.031357"
-       gradientTransform="matrix(1.5918367,0,0,0.85714285,-256.56122,59.685418)"
-       gradientUnits="userSpaceOnUse"
-       id="linearGradient14219"
-       xlink:href="#linearGradient15404"
-       inkscape:collect="always" />
-    <linearGradient
-       inkscape:collect="always"
-       id="linearGradient10013-4-63-6">
-      <stop
-         style="stop-color:#333333;stop-opacity:1;"
-         offset="0"
-         id="stop10015-2-76-1" />
-      <stop
-         style="stop-color:#292929;stop-opacity:1"
-         offset="1"
-         id="stop10017-46-15-8" />
-    </linearGradient>
-    <linearGradient
-       inkscape:collect="always"
-       id="linearGradient10597-5">
-      <stop
-         style="stop-color:#16191a;stop-opacity:1;"
-         offset="0"
-         id="stop10599-2" />
-      <stop
-         style="stop-color:#2b3133;stop-opacity:1"
-         offset="1"
-         id="stop10601-5" />
-    </linearGradient>
-    <linearGradient
-       y2="-322.16354"
-       x2="921.22498"
-       y1="-330.05121"
-       x1="921.32812"
-       gradientTransform="matrix(1.5918367,0,0,0.85714285,-1456.5464,275.45191)"
-       gradientUnits="userSpaceOnUse"
-       id="linearGradient15374"
-       xlink:href="#linearGradient10013-4-63-6"
-       inkscape:collect="always" />
-    <linearGradient
-       gradientTransform="translate(-1199.9852,216.38048)"
-       y2="-227.07961"
-       x2="1203.9177"
-       y1="-217.56708"
-       x1="1203.9177"
-       gradientUnits="userSpaceOnUse"
-       id="linearGradient15376"
-       xlink:href="#linearGradient10597-5"
-       inkscape:collect="always" />
-    <linearGradient
-       id="linearGradient5581-5-2-4-6-8-7-35-8">
-      <stop
-         id="stop5583-0-92-8-0-7-6-5-1"
-         offset="0"
-         style="stop-color:#454c4c;stop-opacity:1;" />
-      <stop
-         style="stop-color:#393f3f;stop-opacity:1;"
-         offset="0.40000001"
-         id="stop5585-4-7-2-7-9-9-92-0" />
-      <stop
-         id="stop5587-6-7-2-0-3-1-21-5"
-         offset="1"
-         style="stop-color:#2d3232;stop-opacity:1;" />
-    </linearGradient>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#a2a2a2"
-     bordercolor="#2d2d2d"
-     borderopacity="1"
-     inkscape:pageopacity="1"
-     inkscape:pageshadow="2"
-     inkscape:zoom="11.313708"
-     inkscape:cx="12.374369"
-     inkscape:cy="8.8388348"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="true"
-     inkscape:window-width="1920"
-     inkscape:window-height="1011"
-     inkscape:window-x="0"
-     inkscape:window-y="0"
-     inkscape:window-maximized="1"
-     borderlayer="true"
-     inkscape:showpageshadow="false"
-     inkscape:snap-nodes="false"
-     inkscape:snap-bbox="true"
-     showborder="true"
-     inkscape:pagecheckerboard="0">
-    <inkscape:grid
-       type="xygrid"
-       id="grid14843"
-       empspacing="5"
-       visible="true"
-       enabled="true"
-       snapvisiblegridlinesonly="true" />
-  </sodipodi:namedview>
-  <metadata
-     id="metadata3204">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(-342.5,-521.36218)">
-    <rect
-       rx="3"
-       y="524.36218"
-       x="345.5"
-       height="18"
-       width="18"
-       id="rect11803"
-       style="color:#000000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#282828;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.15000001;marker:none;enable-background:accumulate"
-       ry="3" />
-    <rect
-       rx="5"
-       y="522.36218"
-       x="343.5"
-       height="22"
-       width="22"
-       id="rect2437"
-       style="color:#000000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#3584e4;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.35;marker:none;enable-background:accumulate"
-       ry="5" />
-  </g>
-</svg>
diff --git a/data/theme/checkbox-off-focused.svg b/data/theme/checkbox-off-focused.svg
deleted file mode 100644
index d5a042e97fe..00000000000
--- a/data/theme/checkbox-off-focused.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="b"><stop offset="0" style="stop-color:#515151;stop-opacity:1"/><stop offset="1" style="stop-color:#292929;stop-opacity:1"/></linearGradient><linearGradient id="a"><stop style="stop-color:#0b2e52;stop-opacity:1" offset="0"/><stop style="stop-color:#1862af;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="c"><stop style="stop-color:#333;stop-opacity:1" offset="0"/><stop style="stop-color:#292929;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="d"><stop style="stop-color:#16191a;stop-opacity:1" offset="0"/><stop style="stop-color:#2b3133;stop-opacity:1" offset="1"/></linearGradient></defs><g transform="translate(-342.5 -521.362)"><rect rx="3" y="524.362" x="345.5" height="18" width="18" style="color:#000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#fff;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:.15000001;marker:none;enable-background:accumulate" ry="3"/><rect rx="5" y="522.362" x="343.5" height="22" width="22" style="color:#000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#3584e4;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:.35;marker:none;enable-background:accumulate" ry="5"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/checkbox-off-light.svg b/data/theme/checkbox-off-light.svg
deleted file mode 100644
index 5d37c85d606..00000000000
--- a/data/theme/checkbox-off-light.svg
+++ /dev/null
@@ -1,211 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-
-<svg
-   width="24"
-   height="24"
-   id="svg3199"
-   version="1.1"
-   inkscape:version="1.1.1 (3bf5ae0d25, 2021-09-20)"
-   sodipodi:docname="checkbox-off-dark.svg"
-   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
-   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
-   xmlns:xlink="http://www.w3.org/1999/xlink"
-   xmlns="http://www.w3.org/2000/svg"
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
-   xmlns:cc="http://creativecommons.org/ns#"
-   xmlns:dc="http://purl.org/dc/elements/1.1/">
-  <defs
-     id="defs3201">
-    <linearGradient
-       id="linearGradient15404"
-       inkscape:collect="always">
-      <stop
-         id="stop15406"
-         offset="0"
-         style="stop-color:#515151;stop-opacity:1" />
-      <stop
-         id="stop15408"
-         offset="1"
-         style="stop-color:#292929;stop-opacity:1" />
-    </linearGradient>
-    <inkscape:perspective
-       sodipodi:type="inkscape:persp3d"
-       inkscape:vp_x="0 : 528.18109 : 1"
-       inkscape:vp_y="0 : 1000 : 0"
-       inkscape:vp_z="744.09448 : 528.18109 : 1"
-       inkscape:persp3d-origin="372.04724 : 352.78739 : 1"
-       id="perspective3207" />
-    <inkscape:perspective
-       id="perspective3187"
-       inkscape:persp3d-origin="0.5 : 2.3333333 : 1"
-       inkscape:vp_z="1 : 2.5 : 1"
-       inkscape:vp_y="0 : 1000 : 0"
-       inkscape:vp_x="0 : 2.5 : 1"
-       sodipodi:type="inkscape:persp3d" />
-    <linearGradient
-       inkscape:collect="always"
-       xlink:href="#linearGradient5872-5-1"
-       id="linearGradient5891-0-4"
-       gradientUnits="userSpaceOnUse"
-       x1="205.84143"
-       y1="246.7094"
-       x2="206.74803"
-       y2="231.24142" />
-    <linearGradient
-       inkscape:collect="always"
-       id="linearGradient5872-5-1">
-      <stop
-         style="stop-color:#0b2e52;stop-opacity:1"
-         offset="0"
-         id="stop5874-4-4" />
-      <stop
-         style="stop-color:#1862af;stop-opacity:1"
-         offset="1"
-         id="stop5876-0-5" />
-    </linearGradient>
-    <inkscape:path-effect
-       effect="spiro"
-       id="path-effect5837-4-6"
-       is_visible="true"
-       lpeversion="0" />
-    <inkscape:path-effect
-       effect="spiro"
-       id="path-effect14768"
-       is_visible="true"
-       lpeversion="0" />
-    <inkscape:path-effect
-       effect="spiro"
-       id="path-effect5884-4-7"
-       is_visible="true"
-       lpeversion="0" />
-    <linearGradient
-       y2="-388.72955"
-       x2="-93.031357"
-       y1="-396.34738"
-       x1="-93.031357"
-       gradientTransform="matrix(1.5918367,0,0,0.85714285,-256.56122,59.685418)"
-       gradientUnits="userSpaceOnUse"
-       id="linearGradient14219"
-       xlink:href="#linearGradient15404"
-       inkscape:collect="always" />
-    <linearGradient
-       inkscape:collect="always"
-       id="linearGradient10013-4-63-6">
-      <stop
-         style="stop-color:#333333;stop-opacity:1;"
-         offset="0"
-         id="stop10015-2-76-1" />
-      <stop
-         style="stop-color:#292929;stop-opacity:1"
-         offset="1"
-         id="stop10017-46-15-8" />
-    </linearGradient>
-    <linearGradient
-       inkscape:collect="always"
-       id="linearGradient10597-5">
-      <stop
-         style="stop-color:#16191a;stop-opacity:1;"
-         offset="0"
-         id="stop10599-2" />
-      <stop
-         style="stop-color:#2b3133;stop-opacity:1"
-         offset="1"
-         id="stop10601-5" />
-    </linearGradient>
-    <linearGradient
-       y2="-322.16354"
-       x2="921.22498"
-       y1="-330.05121"
-       x1="921.32812"
-       gradientTransform="matrix(1.5918367,0,0,0.85714285,-1456.5464,275.45191)"
-       gradientUnits="userSpaceOnUse"
-       id="linearGradient15374"
-       xlink:href="#linearGradient10013-4-63-6"
-       inkscape:collect="always" />
-    <linearGradient
-       gradientTransform="translate(-1199.9852,216.38048)"
-       y2="-227.07961"
-       x2="1203.9177"
-       y1="-217.56708"
-       x1="1203.9177"
-       gradientUnits="userSpaceOnUse"
-       id="linearGradient15376"
-       xlink:href="#linearGradient10597-5"
-       inkscape:collect="always" />
-    <linearGradient
-       id="linearGradient5581-5-2-4-6-8-7-35-8">
-      <stop
-         id="stop5583-0-92-8-0-7-6-5-1"
-         offset="0"
-         style="stop-color:#454c4c;stop-opacity:1;" />
-      <stop
-         style="stop-color:#393f3f;stop-opacity:1;"
-         offset="0.40000001"
-         id="stop5585-4-7-2-7-9-9-92-0" />
-      <stop
-         id="stop5587-6-7-2-0-3-1-21-5"
-         offset="1"
-         style="stop-color:#2d3232;stop-opacity:1;" />
-    </linearGradient>
-  </defs>
-  <sodipodi:namedview
-     id="base"
-     pagecolor="#a2a2a2"
-     bordercolor="#2d2d2d"
-     borderopacity="1"
-     inkscape:pageopacity="1"
-     inkscape:pageshadow="2"
-     inkscape:zoom="11.313708"
-     inkscape:cx="12.374369"
-     inkscape:cy="8.8388348"
-     inkscape:document-units="px"
-     inkscape:current-layer="layer1"
-     showgrid="true"
-     inkscape:window-width="1920"
-     inkscape:window-height="1011"
-     inkscape:window-x="0"
-     inkscape:window-y="0"
-     inkscape:window-maximized="1"
-     borderlayer="true"
-     inkscape:showpageshadow="false"
-     inkscape:snap-nodes="false"
-     inkscape:snap-bbox="true"
-     showborder="true"
-     inkscape:pagecheckerboard="0">
-    <inkscape:grid
-       type="xygrid"
-       id="grid14843"
-       empspacing="5"
-       visible="true"
-       enabled="true"
-       snapvisiblegridlinesonly="true" />
-  </sodipodi:namedview>
-  <metadata
-     id="metadata3204">
-    <rdf:RDF>
-      <cc:Work
-         rdf:about="">
-        <dc:format>image/svg+xml</dc:format>
-        <dc:type
-           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
-      </cc:Work>
-    </rdf:RDF>
-  </metadata>
-  <g
-     inkscape:label="Layer 1"
-     inkscape:groupmode="layer"
-     id="layer1"
-     transform="translate(-342.5,-521.36218)">
-    <rect
-       rx="3"
-       y="524.36218"
-       x="345.5"
-       height="18"
-       width="18"
-       id="rect11803"
-       style="color:#000000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#282828;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.15000001;marker:none;enable-background:accumulate"
-       ry="3" />
-  </g>
-</svg>
diff --git a/data/theme/checkbox-off.svg b/data/theme/checkbox-off.svg
deleted file mode 100644
index 50eece1b028..00000000000
--- a/data/theme/checkbox-off.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="b"><stop offset="0" style="stop-color:#515151;stop-opacity:1"/><stop offset="1" style="stop-color:#292929;stop-opacity:1"/></linearGradient><linearGradient id="a"><stop style="stop-color:#0b2e52;stop-opacity:1" offset="0"/><stop style="stop-color:#1862af;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="c"><stop style="stop-color:#333;stop-opacity:1" offset="0"/><stop style="stop-color:#292929;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="d"><stop style="stop-color:#16191a;stop-opacity:1" offset="0"/><stop style="stop-color:#2b3133;stop-opacity:1" offset="1"/></linearGradient></defs><rect rx="3" y="524.362" x="345.5" height="18" width="18" style="color:#000;display:inline;overflow:visible;visibility:visible;fill:none;fill-opacity:1;stroke:#fff;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:.15000001;marker:none;enable-background:accumulate" ry="3" transform="translate(-342.5 -521.362)"/></svg>
\ No newline at end of file
diff --git a/data/theme/checkbox.svg b/data/theme/checkbox.svg
deleted file mode 100644
index da385b6281d..00000000000
--- a/data/theme/checkbox.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="b"><stop offset="0" style="stop-color:#515151;stop-opacity:1"/><stop offset="1" style="stop-color:#292929;stop-opacity:1"/></linearGradient><linearGradient id="a"><stop style="stop-color:#0b2e52;stop-opacity:1" offset="0"/><stop style="stop-color:#1862af;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="c"><stop style="stop-color:#333;stop-opacity:1" offset="0"/><stop style="stop-color:#292929;stop-opacity:1" offset="1"/></linearGradient><linearGradient id="d"><stop style="stop-color:#16191a;stop-opacity:1" offset="0"/><stop style="stop-color:#2b3133;stop-opacity:1" offset="1"/></linearGradient></defs><g transform="translate(-342.5 -521.362)"><rect rx="3" y="524.362" x="345.5" height="18" width="18" style="color:#000;display:inline;overflow:visible;visibility:visible;fill:#3584e4;fill-opacity:1;stroke:#3584e4;stroke-width:2;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate" ry="3"/><path style="color:#000;fill:#fff;stroke-linecap:round;stroke-linejoin:round;-inkscape-stroke:none" d="M361.998 527.733a1.5 1.5 0 0 0-2.117.127l-6.928 7.824-2.928-2.882a1.5 1.5 0 0 0-2.12.015 1.5 1.5 0 0 0 .015 2.121l4.055 3.993a1.5 1.5 0 0 0 2.175-.075l7.975-9.006a1.5 1.5 0 0 0-.127-2.117z"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/gnome-shell-sass/widgets/_check-box.scss b/data/theme/gnome-shell-sass/widgets/_check-box.scss
index 1480ade2656..f18d6418cf2 100644
--- a/data/theme/gnome-shell-sass/widgets/_check-box.scss
+++ b/data/theme/gnome-shell-sass/widgets/_check-box.scss
@@ -1,18 +1,49 @@
 /* Check Boxes */
 
-// these are equal to the size of the SVG assets
-$check_height: 24px;
-$check_width: 24px;
-
-
 .check-box {
   StBoxLayout { spacing: .8em; }
+
   StBin {
-    width: $check_width;
-    height: $check_height;
-    background-image: if($variant == 'light', url("resource:///org/gnome/shell/theme/checkbox-off-light.svg"), url("resource:///org/gnome/shell/theme/checkbox-off.svg"));
+    border-radius: 7px;
+    padding: 2px;
+  }
+
+  &:focus StBin {
+    // Trick due to St limitations. It needs a background to draw a box-shadow
+    background-color: rgba(0, 0, 0, 0.01);
+    box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, .65);
+  }
+
+  StIcon {
+    icon-size: 14px;
+    padding: 1px;
+
+    color: transparent;
+    border-radius: 6px;
+    border: 2px solid transparentize(if($variant == 'light', black, white), .85);
+  }
+
+  &:hover StIcon {
+    border-color: transparentize(if($variant == 'light', black, white), .8);
+  }
+
+  &:active StIcon {
+    border-color: transparentize(if($variant == 'light', black, white), .7);
+  }
+
+  &:checked StIcon {
+    background-color: $selected_bg_color;
+    color: $selected_fg_color;
+    border-color: transparent;
+  }
+
+  &:checked:hover StIcon {
+    background-color: lighten($selected_bg_color, 5%);
+    color: lighten($selected_fg_color, 5%);
+  }
+
+  &:checked:active StIcon {
+    background-color: darken($selected_bg_color, 7%);
+    color: darken($selected_fg_color, 7%);
   }
-  &:focus StBin { background-image: if($variant == 'light', url("resource:///org/gnome/shell/theme/checkbox-off-focused-light.svg"), url("resource:///org/gnome/shell/theme/checkbox-off-focused.svg"));; }
-  &:checked StBin { background-image: url("resource:///org/gnome/shell/theme/checkbox.svg"); }
-  &:focus:checked StBin { background-image: url("resource:///org/gnome/shell/theme/checkbox-focused.svg"); }
 }
diff --git a/js/ui/checkBox.js b/js/ui/checkBox.js
index d64bd0d6c23..206504576b0 100644
--- a/js/ui/checkBox.js
+++ b/js/ui/checkBox.js
@@ -20,6 +20,11 @@ class CheckBox extends St.Button {
         this._box = new St.Bin({ y_align: Clutter.ActorAlign.START });
         container.add_actor(this._box);
 
+        this._check = new St.Icon({
+            icon_name: 'check-symbolic',
+        });
+        this._box.add_actor(this._check);
+
         this._label = new St.Label({ y_align: Clutter.ActorAlign.CENTER });
         this._label.clutter_text.set_line_wrap(true);
         this._label.clutter_text.set_ellipsize(Pango.EllipsizeMode.NONE);
-- 
GitLab


From d731094bfccaa7d962b8641a9451c4e2d3d3f952 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Daniel=20Ruiz=20de=20Alegr=C3=ADa?= <daniel@drasite.com>
Date: Tue, 7 May 2019 15:20:59 +0200
Subject: [PATCH 2/9] theme: Style switches with pure CSS

---
 data/gnome-shell-icons.gresource.xml          |  2 +
 data/gnome-shell-theme.gresource.xml          |  6 --
 .../scalable/status/switch-off-symbolic.svg   |  1 +
 .../scalable/status/switch-on-symbolic.svg    | 64 +++++++++++++++++++
 data/theme/gnome-shell-high-contrast.scss     |  6 --
 .../gnome-shell-sass/widgets/_switches.scss   | 48 +++++++++++---
 data/theme/toggle-off-hc.svg                  |  1 -
 data/theme/toggle-off-light.svg               |  1 -
 data/theme/toggle-off.svg                     |  1 -
 data/theme/toggle-on-hc.svg                   |  1 -
 data/theme/toggle-on-light.svg                |  1 -
 data/theme/toggle-on.svg                      |  1 -
 js/ui/popupMenu.js                            | 46 +++++++++++--
 13 files changed, 148 insertions(+), 31 deletions(-)
 create mode 100644 data/icons/scalable/status/switch-off-symbolic.svg
 create mode 100644 data/icons/scalable/status/switch-on-symbolic.svg
 delete mode 100644 data/theme/toggle-off-hc.svg
 delete mode 100644 data/theme/toggle-off-light.svg
 delete mode 100644 data/theme/toggle-off.svg
 delete mode 100644 data/theme/toggle-on-hc.svg
 delete mode 100644 data/theme/toggle-on-light.svg
 delete mode 100644 data/theme/toggle-on.svg

diff --git a/data/gnome-shell-icons.gresource.xml b/data/gnome-shell-icons.gresource.xml
index b882ba917e6..6859ca3288e 100644
--- a/data/gnome-shell-icons.gresource.xml
+++ b/data/gnome-shell-icons.gresource.xml
@@ -31,6 +31,8 @@
     <file>scalable/status/screen-privacy-disabled-symbolic.svg</file>
     <file>scalable/status/screen-privacy-symbolic.svg</file>
     <file>scalable/status/stop-symbolic.svg</file>
+    <file>scalable/status/switch-on-symbolic.svg</file>
+    <file>scalable/status/switch-off-symbolic.svg</file>
   </gresource>
 </gresources>
 
diff --git a/data/gnome-shell-theme.gresource.xml b/data/gnome-shell-theme.gresource.xml
index b717e3c5b10..9a22f5d0fa2 100644
--- a/data/gnome-shell-theme.gresource.xml
+++ b/data/gnome-shell-theme.gresource.xml
@@ -8,12 +8,6 @@
     <file>gnome-shell-start.svg</file>
     <file>pad-osd.css</file>
     <file>process-working.svg</file>
-    <file>toggle-off.svg</file>
-    <file>toggle-off-hc.svg</file>
-    <file>toggle-off-light.svg</file>
-    <file>toggle-on.svg</file>
-    <file>toggle-on-hc.svg</file>
-    <file>toggle-on-light.svg</file>
     <file>workspace-placeholder.svg</file>
   </gresource>
 </gresources>
diff --git a/data/icons/scalable/status/switch-off-symbolic.svg b/data/icons/scalable/status/switch-off-symbolic.svg
new file mode 100644
index 00000000000..28e36aa6194
--- /dev/null
+++ b/data/icons/scalable/status/switch-off-symbolic.svg
@@ -0,0 +1 @@
+<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path style="color:#000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-feature-settings:normal;font-variation-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;shape-margin:0;inline-size:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000;solid-opacity:1;vector-effect:none;fill:#000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;paint-order:normal;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate;stop-color:#000;stop-opacity:1;opacity:1" d="M7.979 295.738c-2.76 0-5.016 2.259-5.016 5.018s2.257 5.017 5.016 5.017c2.758 0 5.017-2.258 5.017-5.017 0-2.76-2.259-5.018-5.017-5.018zm0 2a3.003 3.003 0 0 1 3.017 3.018 3.003 3.003 0 0 1-3.017 3.017 3.001 3.001 0 0 1-3.016-3.017 3.001 3.001 0 0 1 3.016-3.018z" transform="translate(0 -292.767)"/></svg>
\ No newline at end of file
diff --git a/data/icons/scalable/status/switch-on-symbolic.svg b/data/icons/scalable/status/switch-on-symbolic.svg
new file mode 100644
index 00000000000..0f0e18fb68a
--- /dev/null
+++ b/data/icons/scalable/status/switch-on-symbolic.svg
@@ -0,0 +1,64 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+
+<svg
+   xmlns:dc="http://purl.org/dc/elements/1.1/"
+   xmlns:cc="http://creativecommons.org/ns#"
+   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
+   xmlns:svg="http://www.w3.org/2000/svg"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
+   width="16"
+   height="16"
+   viewBox="0 0 16 16"
+   version="1.1"
+   id="svg8"
+   inkscape:version="0.92.4 5da689c313, 2019-01-14"
+   sodipodi:docname="on-symbolic.svg">
+  <defs
+     id="defs2" />
+  <sodipodi:namedview
+     id="base"
+     pagecolor="#ffffff"
+     bordercolor="#666666"
+     borderopacity="1.0"
+     inkscape:pageopacity="0.0"
+     inkscape:pageshadow="2"
+     inkscape:zoom="31.678384"
+     inkscape:cx="10.416792"
+     inkscape:cy="9.9204611"
+     inkscape:document-units="px"
+     inkscape:current-layer="layer1"
+     showgrid="true"
+     units="px">
+    <inkscape:grid
+       type="xygrid"
+       id="grid815" />
+  </sodipodi:namedview>
+  <metadata
+     id="metadata5">
+    <rdf:RDF>
+      <cc:Work
+         rdf:about="">
+        <dc:format>image/svg+xml</dc:format>
+        <dc:type
+           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
+        <dc:title></dc:title>
+      </cc:Work>
+    </rdf:RDF>
+  </metadata>
+  <g
+     inkscape:label="Layer 1"
+     inkscape:groupmode="layer"
+     id="layer1"
+     transform="translate(0,-292.76666)">
+    <rect
+       style="opacity:1;vector-effect:none;fill:#000000;fill-opacity:1;stroke:none;stroke-width:2.58198857;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;marker-start:none;marker-mid:none;marker-end:none;paint-order:normal"
+       id="rect817"
+       width="2"
+       height="9.9999971"
+       x="7"
+       y="295.76666" />
+  </g>
+</svg>
diff --git a/data/theme/gnome-shell-high-contrast.scss b/data/theme/gnome-shell-high-contrast.scss
index 00f247e73fd..9698d0d5fc9 100644
--- a/data/theme/gnome-shell-high-contrast.scss
+++ b/data/theme/gnome-shell-high-contrast.scss
@@ -5,12 +5,6 @@ $variant: 'dark';
 @import "gnome-shell-sass/_common";
 @import "gnome-shell-sass/_widgets";
 
-.toggle-switch { width: 48px; }
-.toggle-switch {
-  background-image: url("resource:///org/gnome/shell/theme/toggle-off-hc.svg");
-  &:checked { background-image: url("resource:///org/gnome/shell/theme/toggle-on-hc.svg"); }
-}
-
 //force opaque panel
 #panel {
   &.login-screen,
diff --git a/data/theme/gnome-shell-sass/widgets/_switches.scss b/data/theme/gnome-shell-sass/widgets/_switches.scss
index b6d8fe830f0..489cb0df85f 100644
--- a/data/theme/gnome-shell-sass/widgets/_switches.scss
+++ b/data/theme/gnome-shell-sass/widgets/_switches.scss
@@ -1,16 +1,46 @@
 /* Switches */
 
-// these are equal to the size of the SVG assets
-$switch_height: 26px;
-$switch_width: 48px;
+$switch_width: 3.3em;
+$switch_handle_size: 1.5em;
+$switch_icon_padding: 0.35em;
 
 .toggle-switch {
-  color: $fg_color;
-  height: $switch_height;
   width: $switch_width;
-  background-size: contain;
-  background-image: if($variant == 'light', url("resource:///org/gnome/shell/theme/toggle-off-light.svg"),url("resource:///org/gnome/shell/theme/toggle-off.svg"));
-  &:checked { 
-    background-image: if($variant == 'light', url("resource:///org/gnome/shell/theme/toggle-on-light.svg"),url("resource:///org/gnome/shell/theme/toggle-on.svg"));
+  border-radius: 99px;
+  transition-duration: 100ms;
+
+  @if $is_highcontrast {
+    background: transparentize(if($variant == 'light', black, white), .7);
+    color: white;
+  } @else {
+    background: transparentize(if($variant == 'light', black, white), .85);
+    color: transparent;
+  }
+
+  .switch-icon {
+    icon-size: $base_icon_size;
+    padding: 0 $switch_icon_padding;
+  }
+
+  .handle {
+    margin: 2px;
+    width: $switch_handle_size;
+    height: $switch_handle_size;
+    border-radius: 99px;
+    background: if($variant == 'light', white, mix(white, $bg_color, 80%));
+    box-shadow: 0 2px 4px transparentize(black, .8);
+    transition-duration: 100ms;
+  }
+
+  &:checked {
+    background: $selected_bg_color;
+
+    @if $is_highcontrast {
+      color: $selected_fg_color;
+    }
+
+    .handle {
+      background: white;
+    }
   }
 }
diff --git a/data/theme/toggle-off-hc.svg b/data/theme/toggle-off-hc.svg
deleted file mode 100644
index 26528005f24..00000000000
--- a/data/theme/toggle-off-hc.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="48" height="26" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -291.18)"><rect ry="11" rx="11" y="299.18" x="30" height="10" width="10" style="fill:none;fill-opacity:1;stroke:#f8f7f7;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker:none" fill="#f8f7f7" stroke-linecap="round" stroke-linejoin="round"/><rect style="fill:#fff;stroke:none;stroke-width:1;marker:none;fill-opacity:.4" width="48" height="26" x="-48" y="291.18" ry="13" fill="#3081e3" rx="13" transform="scale(-1 1)"/><rect ry="11" rx="11" y="293.18" x="-24" height="22" width="22" style="stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7" transform="scale(-1 1)"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/toggle-off-light.svg b/data/theme/toggle-off-light.svg
deleted file mode 100644
index 14cb4246a70..00000000000
--- a/data/theme/toggle-off-light.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="48" height="26" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(-1 0 0 1 0 -291.18)"><rect style="fill:#c0bfbc;stroke:none;stroke-width:1;marker:none" width="48" height="26" x="-48" y="291.18" ry="13" fill="#3081e3" rx="13"/><rect ry="11" rx="11" y="294.18" x="-24" height="22" width="22" style="fill:#000;fill-opacity:.2;stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/><rect ry="11" rx="11" y="293.18" x="-24" height="22" width="22" style="stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/toggle-off.svg b/data/theme/toggle-off.svg
deleted file mode 100644
index 323f73b9f4d..00000000000
--- a/data/theme/toggle-off.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="48" height="26" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(-1 0 0 1 0 -291.18)"><rect style="fill:#fff;stroke:none;stroke-width:1;marker:none;fill-opacity:.15000001" width="48" height="26" x="-48" y="291.18" ry="13" fill="#3081e3" rx="13"/><rect ry="11" rx="11" y="294.18" x="-24" height="22" width="22" style="fill:#000;fill-opacity:.2;stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/><rect ry="11" rx="11" y="293.18" x="-24" height="22" width="22" style="stroke:none;stroke-width:.999999;marker:none;fill:#fff;fill-opacity:1" fill="#f8f7f7"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/toggle-on-hc.svg b/data/theme/toggle-on-hc.svg
deleted file mode 100644
index 2d553c64900..00000000000
--- a/data/theme/toggle-on-hc.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="48" height="26" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -291.18)" stroke="none"><rect style="fill:#3584e4;stroke:none;stroke-width:1;marker:none" width="48" height="26" y="291.18" ry="13" fill="#3081e3" rx="13"/><rect ry="11" rx="11" y="293.18" x="24" height="22" width="22" style="stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/></g><path style="fill:#f8f7f7;fill-opacity:1;stroke:none;stroke-width:2;stroke-linejoin:round;stroke-dashoffset:2" d="M14 7v12h-2V7Z"/></svg>
\ No newline at end of file
diff --git a/data/theme/toggle-on-light.svg b/data/theme/toggle-on-light.svg
deleted file mode 100644
index f3dbf315742..00000000000
--- a/data/theme/toggle-on-light.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="48" height="26" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -291.18)"><rect style="fill:#3584e4;stroke:none;stroke-width:1;marker:none" width="48" height="26" y="291.18" ry="13" fill="#3081e3"/><rect ry="11" rx="11" y="294.18" x="24" height="22" width="22" style="stroke:none;stroke-width:.999999;marker:none;fill:#000;fill-opacity:.2" fill="#f8f7f7"/><rect ry="11" rx="11" y="293.18" x="24" height="22" width="22" style="stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/></g></svg>
\ No newline at end of file
diff --git a/data/theme/toggle-on.svg b/data/theme/toggle-on.svg
deleted file mode 100644
index 215760faf58..00000000000
--- a/data/theme/toggle-on.svg
+++ /dev/null
@@ -1 +0,0 @@
-<svg width="48" height="26" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -291.18)"><rect style="fill:#3584e4;stroke:none;stroke-width:1;marker:none" width="48" height="26" y="291.18" ry="13" fill="#3081e3" rx="13"/><rect ry="11" rx="11" y="294.18" x="24" height="22" width="22" style="fill:#000;fill-opacity:.2;stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/><rect ry="11" rx="11" y="293.18" x="24" height="22" width="22" style="fill:#fff;stroke:none;stroke-width:.999999;marker:none" fill="#f8f7f7"/></g></svg>
\ No newline at end of file
diff --git a/js/ui/popupMenu.js b/js/ui/popupMenu.js
index 2f57c58310a..8f95e844f07 100644
--- a/js/ui/popupMenu.js
+++ b/js/ui/popupMenu.js
@@ -327,15 +327,50 @@ var Switch = GObject.registerClass({
             GObject.ParamFlags.READWRITE,
             false),
     },
-}, class Switch extends St.Bin {
+}, class Switch extends St.Widget {
     _init(state) {
         this._state = false;
 
         super._init({
             style_class: 'toggle-switch',
             accessible_role: Atk.Role.CHECK_BOX,
-            state,
         });
+
+        this._iconOn = new St.Icon({
+            style_class: 'switch-icon',
+            icon_name: 'switch-on-symbolic',
+            x_align: Clutter.ActorAlign.START,
+            constraints: new Clutter.BindConstraint({
+                source: this,
+                coordinate: Clutter.BindCoordinate.SIZE,
+            }),
+        });
+        this._iconOff = new St.Icon({
+            style_class: 'switch-icon',
+            icon_name: 'switch-off-symbolic',
+            x_align: Clutter.ActorAlign.END,
+            constraints: new Clutter.BindConstraint({
+                source: this,
+                coordinate: Clutter.BindCoordinate.SIZE,
+            }),
+        });
+
+        this.add_child(this._iconOn);
+        this.add_child(this._iconOff);
+
+        this._handle = new St.Widget({
+            style_class: 'handle',
+            y_align: Clutter.ActorAlign.CENTER,
+            x_align: Clutter.ActorAlign.START,
+            x_expand: true,
+            constraints: new Clutter.BindConstraint({
+                source: this,
+                coordinate: Clutter.BindCoordinate.SIZE,
+            }),
+        });
+        this.add_child(this._handle);
+
+        this.state = state;
     }
 
     get state() {
@@ -346,10 +381,13 @@ var Switch = GObject.registerClass({
         if (this._state === state)
             return;
 
-        if (state)
+        if (state) {
             this.add_style_pseudo_class('checked');
-        else
+            this._handle.x_align = Clutter.ActorAlign.END;
+        } else {
             this.remove_style_pseudo_class('checked');
+            this._handle.x_align = Clutter.ActorAlign.START;
+        }
 
         this._state = state;
         this.notify('state');
-- 
GitLab


From 038dc53d04a239afbe33a99a9fbb7b514242204d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Daniel=20Ruiz=20de=20Alegr=C3=ADa?= <daniel@drasite.com>
Date: Tue, 7 May 2019 16:23:11 +0200
Subject: [PATCH 3/9] toggleSwitch: Animate transitions

---
 js/ui/popupMenu.js | 22 +++++++++++++++++-----
 1 file changed, 17 insertions(+), 5 deletions(-)

diff --git a/js/ui/popupMenu.js b/js/ui/popupMenu.js
index 8f95e844f07..486f63fcbf8 100644
--- a/js/ui/popupMenu.js
+++ b/js/ui/popupMenu.js
@@ -361,13 +361,16 @@ var Switch = GObject.registerClass({
         this._handle = new St.Widget({
             style_class: 'handle',
             y_align: Clutter.ActorAlign.CENTER,
-            x_align: Clutter.ActorAlign.START,
-            x_expand: true,
             constraints: new Clutter.BindConstraint({
                 source: this,
-                coordinate: Clutter.BindCoordinate.SIZE,
+                coordinate: Clutter.BindCoordinate.HEIGHT,
             }),
         });
+        this._handleAlignConstraint = new Clutter.AlignConstraint({
+            align_axis: Clutter.AlignAxis.X_AXIS,
+            source: this,
+        });
+        this._handle.add_constraint_with_name('align', this._handleAlignConstraint);
         this.add_child(this._handle);
 
         this.state = state;
@@ -381,14 +384,23 @@ var Switch = GObject.registerClass({
         if (this._state === state)
             return;
 
+        let handleAlignFactor;
+        const duration = this._handle.mapped
+            ? this._handle.get_theme_node().get_transition_duration()
+            : 0;
+
         if (state) {
             this.add_style_pseudo_class('checked');
-            this._handle.x_align = Clutter.ActorAlign.END;
+            handleAlignFactor = 1.0;
         } else {
             this.remove_style_pseudo_class('checked');
-            this._handle.x_align = Clutter.ActorAlign.START;
+            handleAlignFactor = 0.0;
         }
 
+        this._handle.ease_property('@constraints.align.factor', handleAlignFactor, {
+            duration,
+        });
+
         this._state = state;
         this.notify('state');
     }
-- 
GitLab


From 028a2d25f7a84645b583bef597b87d71964d564e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Daniel=20Ruiz=20de=20Alegr=C3=ADa?= <daniel@drasite.com>
Date: Tue, 21 Jan 2020 11:30:42 +0100
Subject: [PATCH 4/9] toggleSwitch: Make handle draggable

---
 js/ui/popupMenu.js | 112 +++++++++++++++++++++++++++++++++++++++++----
 1 file changed, 103 insertions(+), 9 deletions(-)

diff --git a/js/ui/popupMenu.js b/js/ui/popupMenu.js
index 486f63fcbf8..be9715d8995 100644
--- a/js/ui/popupMenu.js
+++ b/js/ui/popupMenu.js
@@ -328,12 +328,14 @@ var Switch = GObject.registerClass({
             false),
     },
 }, class Switch extends St.Widget {
-    _init(state) {
+    _init(state, reactive = true) {
         this._state = false;
+        this._dragging = false;
 
         super._init({
             style_class: 'toggle-switch',
             accessible_role: Atk.Role.CHECK_BOX,
+            reactive,
         });
 
         this._iconOn = new St.Icon({
@@ -365,12 +367,15 @@ var Switch = GObject.registerClass({
                 source: this,
                 coordinate: Clutter.BindCoordinate.HEIGHT,
             }),
+            reactive,
         });
         this._handleAlignConstraint = new Clutter.AlignConstraint({
             align_axis: Clutter.AlignAxis.X_AXIS,
             source: this,
         });
         this._handle.add_constraint_with_name('align', this._handleAlignConstraint);
+        this._handle.connect('button-press-event', (actor, event) => this._startDragging(event));
+        this._handle.connect('touch-event', this._touchDragging.bind(this));
         this.add_child(this._handle);
 
         this.state = state;
@@ -381,9 +386,6 @@ var Switch = GObject.registerClass({
     }
 
     set state(state) {
-        if (this._state === state)
-            return;
-
         let handleAlignFactor;
         const duration = this._handle.mapped
             ? this._handle.get_theme_node().get_transition_duration()
@@ -401,13 +403,99 @@ var Switch = GObject.registerClass({
             duration,
         });
 
-        this._state = state;
-        this.notify('state');
+        if (this._state !== state) {
+            this._state = state;
+            this.notify('state');
+        }
     }
 
     toggle() {
         this.state = !this.state;
     }
+
+    _startDragging(event) {
+        if (this._dragging)
+            return Clutter.EVENT_PROPAGATE;
+
+        this._dragging = true;
+        [this._initialGrabX] = event.get_coords();
+        let device = event.get_device();
+        let sequence = event.get_event_sequence();
+
+        this._grab = global.stage.grab(this);
+
+        this._grabbedDevice = device;
+        this._grabbedSequence = sequence;
+
+        return Clutter.EVENT_STOP;
+    }
+
+    vfunc_motion_event() {
+        if (this._dragging && !this._grabbedSequence)
+            return this._motionEvent(this, Clutter.get_current_event());
+
+        return Clutter.EVENT_PROPAGATE;
+    }
+
+    vfunc_button_release_event() {
+        if (this._dragging && !this._grabbedSequence)
+            return this._endDragging();
+
+        return Clutter.EVENT_PROPAGATE;
+    }
+
+    _touchDragging(actor, event) {
+        let sequence = event.get_event_sequence();
+
+        if (!this._dragging &&
+            event.type() === Clutter.EventType.TOUCH_BEGIN) {
+            this.startDragging(event);
+            return Clutter.EVENT_STOP;
+        } else if (this._grabbedSequence &&
+                   sequence.get_slot() === this._grabbedSequence.get_slot()) {
+            if (event.type() === Clutter.EventType.TOUCH_UPDATE)
+                return this._motionEvent(this, event);
+            else if (event.type() === Clutter.EventType.TOUCH_END)
+                return this._endDragging();
+        }
+
+        return Clutter.EVENT_PROPAGATE;
+    }
+
+    _endDragging() {
+        if (this._dragging) {
+            if (this._grab) {
+                this._grab.dismiss();
+                this._grab = null;
+            }
+
+            if (this._dragged === null)
+                this.toggle();
+            else
+                this.state = this._handleAlignConstraint.get_factor() > 0.5;
+
+            this._dragged = null;
+            this._grabbedSequence = null;
+            this._grabbedDevice = null;
+            this._dragging = false;
+        }
+        return Clutter.EVENT_STOP;
+    }
+
+    _motionEvent(actor, event) {
+        this._dragged = true;
+
+        let [absX] = event.get_coords();
+        let factorDiff = (absX - this._initialGrabX) / (this.get_width() - this._handle.get_width());
+        let factor = factorDiff + (this.state ? 1.0 : 0.0);
+
+        factor = Math.max(factor, 0.0);
+        factor = Math.min(factor, 1.0);
+
+        this._handleAlignConstraint.set_factor(factor);
+
+        return Clutter.EVENT_STOP;
+    }
 });
 
 var PopupSwitchMenuItem = GObject.registerClass({
@@ -421,7 +509,10 @@ var PopupSwitchMenuItem = GObject.registerClass({
             y_expand: true,
             y_align: Clutter.ActorAlign.CENTER,
         });
-        this._switch = new Switch(active);
+
+        let switchReactive = params && params.reactive;
+        this._switch = new Switch(active, switchReactive);
+        this._switch.connect('notify::state', this._onToggled.bind(this));
 
         this.accessible_role = Atk.Role.CHECK_MENU_ITEM;
         this.checkAccessibleState();
@@ -473,8 +564,6 @@ var PopupSwitchMenuItem = GObject.registerClass({
 
     toggle() {
         this._switch.toggle();
-        this.emit('toggled', this._switch.state);
-        this.checkAccessibleState();
     }
 
     get state() {
@@ -486,6 +575,11 @@ var PopupSwitchMenuItem = GObject.registerClass({
         this.checkAccessibleState();
     }
 
+    _onToggled(sw, state) {
+        this.emit('toggled', state);
+        this.checkAccessibleState();
+    }
+
     checkAccessibleState() {
         switch (this.accessible_role) {
         case Atk.Role.CHECK_MENU_ITEM:
-- 
GitLab


From 957a162a99a6482452f81d8b7f4dc876cf87e11f Mon Sep 17 00:00:00 2001
From: Alexander Mikhaylenko <alexm@gnome.org>
Date: Tue, 21 Mar 2023 22:59:39 +0400
Subject: [PATCH 5/9] st/settings: Add :accent-color

---
 src/st/meson.build   |  2 +-
 src/st/st-settings.c | 26 ++++++++++++++++++++++++++
 src/st/st-settings.h | 14 ++++++++++++++
 3 files changed, 41 insertions(+), 1 deletion(-)

diff --git a/src/st/meson.build b/src/st/meson.build
index 456860d56ae..d77e43ba8c0 100644
--- a/src/st/meson.build
+++ b/src/st/meson.build
@@ -183,7 +183,7 @@ st_cflags = [
 libst = shared_library('st-' + mutter_api_version,
   sources: st_gir_sources + st_nogir_sources + croco_sources,
   c_args: st_cflags,
-  dependencies: [clutter_dep, mutter_dep, libxml_dep, gdk_pixbuf_dep, m_dep],
+  dependencies: [clutter_dep, mutter_dep, libxml_dep, gdk_pixbuf_dep, m_dep, schemas_dep],
   build_rpath: mutter_typelibdir,
   install_rpath: mutter_typelibdir,
   install_dir: pkglibdir,
diff --git a/src/st/st-settings.c b/src/st/st-settings.c
index 04bf68f405a..90afc2e33e9 100644
--- a/src/st/st-settings.c
+++ b/src/st/st-settings.c
@@ -26,11 +26,13 @@
 
 #include "st-private.h"
 #include "st-settings.h"
+#include "st-enum-types.h"
 
 #define KEY_ENABLE_ANIMATIONS     "enable-animations"
 #define KEY_PRIMARY_PASTE         "gtk-enable-primary-paste"
 #define KEY_DRAG_THRESHOLD        "drag-threshold"
 #define KEY_FONT_NAME             "font-name"
+#define KEY_ACCENT_COLOR          "accent-color"
 #define KEY_HIGH_CONTRAST         "high-contrast"
 #define KEY_GTK_ICON_THEME        "icon-theme"
 #define KEY_MAGNIFIER_ACTIVE      "screen-magnifier-enabled"
@@ -42,6 +44,7 @@ enum {
   PROP_PRIMARY_PASTE,
   PROP_DRAG_THRESHOLD,
   PROP_FONT_NAME,
+  PROP_ACCENT_COLOR,
   PROP_HIGH_CONTRAST,
   PROP_GTK_ICON_THEME,
   PROP_MAGNIFIER_ACTIVE,
@@ -62,6 +65,7 @@ struct _StSettings
   GSettings *lockdown_settings;
 
   gchar *font_name;
+  StSystemAccentColor accent_color;
   gboolean high_contrast;
   gchar *gtk_icon_theme;
   int inhibit_animations_count;
@@ -179,6 +183,9 @@ st_settings_get_property (GObject    *object,
     case PROP_FONT_NAME:
       g_value_set_string (value, settings->font_name);
       break;
+    case PROP_ACCENT_COLOR:
+      g_value_set_enum (value, settings->accent_color);
+      break;
     case PROP_HIGH_CONTRAST:
       g_value_set_boolean (value, settings->high_contrast);
       break;
@@ -253,6 +260,18 @@ st_settings_class_init (StSettingsClass *klass)
                                                "",
                                                ST_PARAM_READABLE);
 
+  /**
+   * StSettings:accent-color:
+   *
+   * The current accent color.
+   */
+  props[PROP_ACCENT_COLOR] = g_param_spec_enum ("accent-color",
+                                                "accent color",
+                                                "accent color",
+                                                ST_TYPE_SYSTEM_ACCENT_COLOR,
+                                                ST_SYSTEM_ACCENT_COLOR_BLUE,
+                                                ST_PARAM_READABLE);
+
   /**
    * StSettings:high-contrast:
    *
@@ -332,6 +351,11 @@ on_interface_settings_changed (GSettings   *g_settings,
       settings->font_name = g_settings_get_string (g_settings, key);
       g_object_notify_by_pspec (G_OBJECT (settings), props[PROP_FONT_NAME]);
     }
+  else if (g_str_equal (key, KEY_ACCENT_COLOR))
+    {
+      settings->accent_color = g_settings_get_enum (g_settings, key);
+      g_object_notify_by_pspec (G_OBJECT (settings), props[PROP_ACCENT_COLOR]);
+    }
   else if (g_str_equal (key, KEY_GTK_ICON_THEME))
     {
       g_free (settings->gtk_icon_theme);
@@ -420,6 +444,8 @@ st_settings_init (StSettings *settings)
                                                     KEY_PRIMARY_PASTE);
   settings->font_name = g_settings_get_string (settings->interface_settings,
                                                KEY_FONT_NAME);
+  settings->accent_color = g_settings_get_enum (settings->interface_settings,
+                                                KEY_ACCENT_COLOR);
   settings->gtk_icon_theme = g_settings_get_string (settings->interface_settings,
                                                     KEY_GTK_ICON_THEME);
   settings->drag_threshold = g_settings_get_int (settings->mouse_settings,
diff --git a/src/st/st-settings.h b/src/st/st-settings.h
index 8b254946995..2e9f28c1c90 100644
--- a/src/st/st-settings.h
+++ b/src/st/st-settings.h
@@ -25,9 +25,23 @@
 #define __ST_SETTINGS_H__
 
 #include <glib-object.h>
+#include <gdesktop-enums.h>
 
 G_BEGIN_DECLS
 
+typedef enum {
+  ST_SYSTEM_ACCENT_COLOR_BLUE = G_DESKTOP_ACCENT_COLOR_BLUE,
+  ST_SYSTEM_ACCENT_COLOR_TEAL = G_DESKTOP_ACCENT_COLOR_TEAL,
+  ST_SYSTEM_ACCENT_COLOR_GREEN = G_DESKTOP_ACCENT_COLOR_GREEN,
+  ST_SYSTEM_ACCENT_COLOR_YELLOW = G_DESKTOP_ACCENT_COLOR_YELLOW,
+  ST_SYSTEM_ACCENT_COLOR_ORANGE = G_DESKTOP_ACCENT_COLOR_ORANGE,
+  ST_SYSTEM_ACCENT_COLOR_RED = G_DESKTOP_ACCENT_COLOR_RED,
+  ST_SYSTEM_ACCENT_COLOR_PINK = G_DESKTOP_ACCENT_COLOR_PINK,
+  ST_SYSTEM_ACCENT_COLOR_PURPLE = G_DESKTOP_ACCENT_COLOR_PURPLE,
+  ST_SYSTEM_ACCENT_COLOR_BROWN = G_DESKTOP_ACCENT_COLOR_BROWN,
+  ST_SYSTEM_ACCENT_COLOR_SLATE = G_DESKTOP_ACCENT_COLOR_SLATE,
+} StSystemAccentColor;
+
 #define ST_TYPE_SETTINGS (st_settings_get_type ())
 G_DECLARE_FINAL_TYPE (StSettings, st_settings, ST, SETTINGS, GObject)
 
-- 
GitLab


From fce54f4043e52dd0f1a2be4d8761b0d013eda494 Mon Sep 17 00:00:00 2001
From: Alexander Mikhaylenko <alexm@gnome.org>
Date: Tue, 21 Mar 2023 23:00:15 +0400
Subject: [PATCH 6/9] st/theme-context: Expose accent color

---
 src/st/st-theme-context.c | 116 ++++++++++++++++++++++++++++++++++++++
 src/st/st-theme-context.h |  22 +++++---
 2 files changed, 129 insertions(+), 9 deletions(-)

diff --git a/src/st/st-theme-context.c b/src/st/st-theme-context.c
index 4055786d629..3ef3f722ddc 100644
--- a/src/st/st-theme-context.c
+++ b/src/st/st-theme-context.c
@@ -28,10 +28,27 @@
 #include "st-theme-context.h"
 #include "st-theme-node-private.h"
 
+#define ACCENT_COLOR_BLUE   0x3584e4ff
+#define ACCENT_COLOR_TEAL   0x7ad9f1ff
+#define ACCENT_COLOR_GREEN  0x26a269ff
+#define ACCENT_COLOR_YELLOW 0xe5a50aff
+#define ACCENT_COLOR_ORANGE 0xe66100ff
+#define ACCENT_COLOR_RED    0xc01c28ff
+#define ACCENT_COLOR_PINK   0xe55294ff
+#define ACCENT_COLOR_PURPLE 0x9141acff
+#define ACCENT_COLOR_BROWN  0x965e3cff
+#define ACCENT_COLOR_SLATE  0x7592b0ff
+
+#define ACCENT_FG_COLOR_LIGHT 0xffffffff
+#define ACCENT_FG_COLOR_DARK  0x000000cc
+
 struct _StThemeContext {
   GObject parent;
 
   PangoFontDescription *font;
+  ClutterColor accent_color;
+  ClutterColor accent_fg_color;
+
   StThemeNode *root_node;
   StTheme *theme;
 
@@ -68,6 +85,7 @@ static PangoFontDescription *get_interface_font_description (void);
 static void on_font_name_changed (StSettings     *settings,
                                   GParamSpec     *pspec,
                                   StThemeContext *context);
+static void update_accent_colors (StThemeContext *context);
 static void on_icon_theme_changed (StTextureCache *cache,
                                    StThemeContext *context);
 static void st_theme_context_changed (StThemeContext *context);
@@ -102,6 +120,9 @@ st_theme_context_finalize (GObject *object)
   g_signal_handlers_disconnect_by_func (st_settings_get (),
                                         (gpointer) on_font_name_changed,
                                         context);
+  g_signal_handlers_disconnect_by_func (st_settings_get (),
+                                        (gpointer) update_accent_colors,
+                                        context);
   g_signal_handlers_disconnect_by_func (st_texture_cache_get_default (),
                                        (gpointer) on_icon_theme_changed,
                                        context);
@@ -171,6 +192,10 @@ st_theme_context_init (StThemeContext *context)
                     "notify::font-name",
                     G_CALLBACK (on_font_name_changed),
                     context);
+  g_signal_connect_swapped (st_settings_get (),
+                            "notify::accent-color",
+                            G_CALLBACK (update_accent_colors),
+                            context);
   g_signal_connect (st_texture_cache_get_default (),
                     "icon-theme-changed",
                     G_CALLBACK (on_icon_theme_changed),
@@ -184,6 +209,8 @@ st_theme_context_init (StThemeContext *context)
                                           (GEqualFunc) st_theme_node_equal,
                                           g_object_unref, NULL);
   context->scale_factor = 1;
+
+  update_accent_colors (context);
 }
 
 static void
@@ -254,6 +281,73 @@ get_interface_font_description (void)
   return pango_font_description_from_string (font_name);
 }
 
+static void
+update_accent_colors (StThemeContext *context)
+{
+  StSettings *settings = st_settings_get ();
+  StSystemAccentColor accent_color;
+
+  g_object_get (settings, "accent-color", &accent_color, NULL);
+
+  switch (accent_color)
+    {
+    case ST_SYSTEM_ACCENT_COLOR_BLUE:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_BLUE);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_TEAL:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_TEAL);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_DARK);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_GREEN:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_GREEN);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_YELLOW:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_YELLOW);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_DARK);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_ORANGE:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_ORANGE);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_RED:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_RED);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_PINK:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_PINK);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_PURPLE:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_PURPLE);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_BROWN:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_BROWN);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    case ST_SYSTEM_ACCENT_COLOR_SLATE:
+      clutter_color_from_pixel (&context->accent_color, ACCENT_COLOR_SLATE);
+      clutter_color_from_pixel (&context->accent_fg_color, ACCENT_FG_COLOR_LIGHT);
+      break;
+
+    default:
+      g_assert_not_reached ();
+    }
+
+  st_theme_context_changed (context);
+}
+
 static void
 on_stage_destroy (ClutterStage *stage)
 {
@@ -431,6 +525,28 @@ st_theme_context_get_font (StThemeContext *context)
   return context->font;
 }
 
+/**
+ * st_theme_context_get_accent_color:
+ * @context: a #StThemeContext
+ * @color: (out) (nullable): the accent color
+ * @fg_color: (out) (nullable): the foreground accent color
+ *
+ * Gets the current accent color for the theme context.
+ */
+void
+st_theme_context_get_accent_color (StThemeContext *context,
+                                   ClutterColor   *color,
+                                   ClutterColor   *fg_color)
+{
+  g_return_if_fail (ST_IS_THEME_CONTEXT (context));
+
+  if (color)
+    memcpy (color, &context->accent_color, sizeof (ClutterColor));
+
+  if (fg_color)
+    memcpy (fg_color, &context->accent_fg_color, sizeof (ClutterColor));
+}
+
 /**
  * st_theme_context_get_root_node:
  * @context: a #StThemeContext
diff --git a/src/st/st-theme-context.h b/src/st/st-theme-context.h
index 165ce25f192..3adeecc7d47 100644
--- a/src/st/st-theme-context.h
+++ b/src/st/st-theme-context.h
@@ -45,18 +45,22 @@ G_DECLARE_FINAL_TYPE (StThemeContext, st_theme_context,
 StThemeContext *st_theme_context_new           (void);
 StThemeContext *st_theme_context_get_for_stage (ClutterStage *stage);
 
-void                        st_theme_context_set_theme      (StThemeContext             *context,
-                                                             StTheme                    *theme);
-StTheme *                   st_theme_context_get_theme      (StThemeContext             *context);
+void                        st_theme_context_set_theme        (StThemeContext             *context,
+                                                               StTheme                    *theme);
+StTheme *                   st_theme_context_get_theme        (StThemeContext             *context);
 
-void                        st_theme_context_set_font       (StThemeContext             *context,
-                                                             const PangoFontDescription *font);
-const PangoFontDescription *st_theme_context_get_font       (StThemeContext             *context);
+void                        st_theme_context_set_font         (StThemeContext             *context,
+                                                               const PangoFontDescription *font);
+const PangoFontDescription *st_theme_context_get_font         (StThemeContext             *context);
 
-StThemeNode *               st_theme_context_get_root_node  (StThemeContext             *context);
+void                        st_theme_context_get_accent_color (StThemeContext             *context,
+                                                               ClutterColor               *color,
+                                                               ClutterColor               *fg_color);
 
-StThemeNode *               st_theme_context_intern_node    (StThemeContext             *context,
-                                                             StThemeNode                *node);
+StThemeNode *               st_theme_context_get_root_node    (StThemeContext             *context);
+
+StThemeNode *               st_theme_context_intern_node      (StThemeContext             *context,
+                                                               StThemeNode                *node);
 
 int st_theme_context_get_scale_factor (StThemeContext *context);
 
-- 
GitLab


From 9ae9cf0e8519a7df9e31681e371ac70930cf2dac Mon Sep 17 00:00:00 2001
From: Alexander Mikhaylenko <alexm@gnome.org>
Date: Wed, 22 Mar 2023 00:02:51 +0400
Subject: [PATCH 7/9] st/theme-node: Implement extensions for accent color

Add -st-accent-color and -st-fg-accent-color so that these colors can be
accessed from CSS.

Since they are often transformed in SCSS atm, add st-transparentize(),
st-mix(), st-lighten(), st-darken() that work in runtime.
---
 src/st/st-theme-node.c | 236 +++++++++++++++++++++++++++++++++++++++++
 1 file changed, 236 insertions(+)

diff --git a/src/st/st-theme-node.c b/src/st/st-theme-node.c
index 6e09c3939a3..eda5f41eeb8 100644
--- a/src/st/st-theme-node.c
+++ b/src/st/st-theme-node.c
@@ -503,6 +503,20 @@ term_is_transparent (CRTerm *term)
           strcmp (term->content.str->stryng->str, "transparent") == 0);
 }
 
+static gboolean
+term_is_accent_color (CRTerm *term)
+{
+  return (term->type == TERM_IDENT &&
+          strcmp (term->content.str->stryng->str, "-st-accent-color") == 0);
+}
+
+static gboolean
+term_is_accent_fg_color (CRTerm *term)
+{
+  return (term->type == TERM_IDENT &&
+          strcmp (term->content.str->stryng->str, "-st-accent-fg-color") == 0);
+}
+
 static int
 color_component_from_double (double component)
 {
@@ -595,6 +609,180 @@ get_color_from_rgba_term (CRTerm       *term,
   return VALUE_FOUND;
 }
 
+static GetFromTermResult get_color_from_term (StThemeNode  *node,
+                                              CRTerm       *term,
+                                              ClutterColor *color);
+
+static GetFromTermResult
+get_color_from_transparentize_term (StThemeNode  *node,
+                                    CRTerm       *term,
+                                    ClutterColor *color)
+{
+  CRTerm *color_arg = term->ext_content.func_param;
+  CRTerm *amount_arg = color_arg->next;
+  ClutterColor base_color;
+  CRNum *amount_num;
+  double amount;
+
+  if (!color_arg || !amount_arg)
+    return VALUE_NOT_FOUND;
+
+  if (get_color_from_term (node, color_arg, &base_color) != VALUE_FOUND)
+    return VALUE_NOT_FOUND;
+
+  if (amount_arg->type != TERM_NUMBER)
+    return VALUE_NOT_FOUND;
+
+  amount_num = amount_arg->content.num;
+
+  if (amount_num->type == NUM_PERCENTAGE)
+    amount = amount_num->val / 100;
+  else if (amount_num->type == NUM_GENERIC)
+    amount = amount_num->val;
+  else
+    return VALUE_NOT_FOUND;
+
+  color->red = base_color.red;
+  color->green = base_color.green;
+  color->blue = base_color.blue;
+  color->alpha = CLAMP (base_color.alpha - amount * 255, 0, 255);
+
+  return VALUE_FOUND;
+}
+
+#define LERP(a, b, t) (a + (b - a) * t)
+
+static GetFromTermResult
+get_color_from_mix_term (StThemeNode  *node,
+                         CRTerm       *term,
+                         ClutterColor *color)
+{
+  CRTerm *color1_arg = term->ext_content.func_param;
+  CRTerm *color2_arg = color1_arg->next;
+  CRTerm *factor_arg = color2_arg->next;
+  ClutterColor color1, color2;
+  CRNum *factor_num;
+  double factor;
+
+  if (!color1_arg || !color2_arg || !factor_arg)
+    return VALUE_NOT_FOUND;
+
+  if (get_color_from_term (node, color1_arg, &color1) != VALUE_FOUND ||
+      get_color_from_term (node, color2_arg, &color2) != VALUE_FOUND)
+    return VALUE_NOT_FOUND;
+
+  if (factor_arg->type != TERM_NUMBER)
+    return VALUE_NOT_FOUND;
+
+  factor_num = factor_arg->content.num;
+
+  if (factor_num->type == NUM_PERCENTAGE)
+    factor = factor_num->val / 100;
+  else if (factor_num->type == NUM_GENERIC)
+    factor = factor_num->val;
+  else
+    return VALUE_NOT_FOUND;
+
+  /* SCSS mix() inverts the factor for some reason */
+  factor = 1 - factor;
+
+  color->alpha = CLAMP (LERP (color1.alpha, color2.alpha, factor), 0, 255);
+
+  if (color->alpha == 0)
+    {
+      color->red = color->green = color->blue = 0;
+    }
+  else
+    {
+      color->red   = CLAMP (LERP (color1.red   * color1.alpha, color2.red   * color2.alpha, factor) / color->alpha, 0, 255);
+      color->green = CLAMP (LERP (color1.green * color1.alpha, color2.green * color2.alpha, factor) / color->alpha, 0, 255);
+      color->blue  = CLAMP (LERP (color1.blue  * color1.alpha, color2.blue  * color2.alpha, factor) / color->alpha, 0, 255);
+    }
+
+  return VALUE_FOUND;
+}
+
+static GetFromTermResult
+get_color_from_lighten_term (StThemeNode  *node,
+                             CRTerm       *term,
+                             ClutterColor *color)
+{
+  CRTerm *color_arg = term->ext_content.func_param;
+  CRTerm *factor_arg = color_arg->next;
+  ClutterColor base_color;
+  CRNum *factor_num;
+  double factor;
+  float hue, luminance, saturation;
+
+  if (!color_arg || !factor_arg)
+    return VALUE_NOT_FOUND;
+
+  if (get_color_from_term (node, color_arg, &base_color) != VALUE_FOUND)
+    return VALUE_NOT_FOUND;
+
+  if (factor_arg->type != TERM_NUMBER)
+    return VALUE_NOT_FOUND;
+
+  factor_num = factor_arg->content.num;
+
+  if (factor_num->type == NUM_PERCENTAGE)
+    factor = factor_num->val / 100;
+  else if (factor_num->type == NUM_GENERIC)
+    factor = factor_num->val;
+  else
+    return VALUE_NOT_FOUND;
+
+  clutter_color_to_hls (&base_color, &hue, &luminance, &saturation);
+
+  luminance = CLAMP (luminance + factor, 0, 1);
+
+  clutter_color_from_hls (color, hue, luminance, saturation);
+  color->alpha = base_color.alpha;
+
+  return VALUE_FOUND;
+}
+
+static GetFromTermResult
+get_color_from_darken_term (StThemeNode  *node,
+                            CRTerm       *term,
+                            ClutterColor *color)
+{
+  CRTerm *color_arg = term->ext_content.func_param;
+  CRTerm *factor_arg = color_arg->next;
+  ClutterColor base_color;
+  CRNum *factor_num;
+  double factor;
+  float hue, luminance, saturation;
+
+  if (!color_arg || !factor_arg)
+    return VALUE_NOT_FOUND;
+
+  if (get_color_from_term (node, color_arg, &base_color) != VALUE_FOUND)
+    return VALUE_NOT_FOUND;
+
+  if (factor_arg->type != TERM_NUMBER)
+    return VALUE_NOT_FOUND;
+
+  factor_num = factor_arg->content.num;
+
+  if (factor_num->type == NUM_PERCENTAGE)
+    factor = factor_num->val / 100;
+  else if (factor_num->type == NUM_GENERIC)
+    factor = factor_num->val;
+  else
+    return VALUE_NOT_FOUND;
+
+  clutter_color_to_hls (&base_color, &hue, &luminance, &saturation);
+  color->alpha = base_color.alpha;
+
+  luminance = CLAMP (luminance - factor, 0, 1);
+
+  clutter_color_from_hls (color, hue, luminance, saturation);
+  color->alpha = base_color.alpha;
+
+  return VALUE_FOUND;
+}
+
 static GetFromTermResult
 get_color_from_term (StThemeNode  *node,
                      CRTerm       *term,
@@ -615,6 +803,18 @@ get_color_from_term (StThemeNode  *node,
       *color = TRANSPARENT_COLOR;
       return VALUE_FOUND;
     }
+  /* St-specific extension: -st-accent-color */
+  else if (term_is_accent_color (term))
+    {
+      st_theme_context_get_accent_color (node->context, color, NULL);
+      return VALUE_FOUND;
+    }
+  /* St-specific extension: -st-accent-fg-color */
+  else if (term_is_accent_fg_color (term))
+    {
+      st_theme_context_get_accent_color (node->context, NULL, color);
+      return VALUE_FOUND;
+    }
   /* rgba () colors - a CSS3 addition, are not supported by libcroco,
    * but they are parsed as a "function", so we can emulate the
    * functionality.
@@ -627,6 +827,42 @@ get_color_from_term (StThemeNode  *node,
     {
       return get_color_from_rgba_term (term, color);
     }
+  /* St-specific extension: st-transparentize() */
+  else if (term->type == TERM_FUNCTION &&
+           term->content.str &&
+           term->content.str->stryng &&
+           term->content.str->stryng->str &&
+           strcmp (term->content.str->stryng->str, "st-transparentize") == 0)
+    {
+      return get_color_from_transparentize_term (node, term, color);
+    }
+  /* St-specific extension: st-mix() */
+  else if (term->type == TERM_FUNCTION &&
+           term->content.str &&
+           term->content.str->stryng &&
+           term->content.str->stryng->str &&
+           strcmp (term->content.str->stryng->str, "st-mix") == 0)
+    {
+      return get_color_from_mix_term (node, term, color);
+    }
+  /* St-specific extension: st-lighten() */
+  else if (term->type == TERM_FUNCTION &&
+           term->content.str &&
+           term->content.str->stryng &&
+           term->content.str->stryng->str &&
+           strcmp (term->content.str->stryng->str, "st-lighten") == 0)
+    {
+      return get_color_from_lighten_term (node, term, color);
+    }
+  /* St-specific extension: st-darken() */
+  else if (term->type == TERM_FUNCTION &&
+           term->content.str &&
+           term->content.str->stryng &&
+           term->content.str->stryng->str &&
+           strcmp (term->content.str->stryng->str, "st-darken") == 0)
+    {
+      return get_color_from_darken_term (node, term, color);
+    }
 
   status = cr_rgb_set_from_term (&rgb, term);
   if (status != CR_OK)
-- 
GitLab


From 372bb787eeedaf3f74bc9e61ab9d7b03067787a6 Mon Sep 17 00:00:00 2001
From: Alexander Mikhaylenko <alexm@gnome.org>
Date: Wed, 22 Mar 2023 00:07:55 +0400
Subject: [PATCH 8/9] theme: Use transparent text selection

Match libadwaita.
---
 data/theme/gnome-shell-sass/_common.scss | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/data/theme/gnome-shell-sass/_common.scss b/data/theme/gnome-shell-sass/_common.scss
index 79c96001f21..3e793bde577 100644
--- a/data/theme/gnome-shell-sass/_common.scss
+++ b/data/theme/gnome-shell-sass/_common.scss
@@ -115,8 +115,8 @@ stage {
   border-radius: $base_border_radius;
   padding: $base_padding*1.5 $base_padding*1.5;
   color: $fg_color;
-  selection-background-color: $selected_bg_color;
-  selected-color: $selected_fg_color;
+  selection-background-color: transparentize($selected_bg_color, 0.7);
+  selected-color: $fg_color;
 
   @include entry(normal);
   &:hover { @include entry(hover);}
-- 
GitLab


From 899bc1007d34a1776ecbf119466e50a46897bed0 Mon Sep 17 00:00:00 2001
From: Alexander Mikhaylenko <alexm@gnome.org>
Date: Wed, 22 Mar 2023 00:06:01 +0400
Subject: [PATCH 9/9] theme: Support accent color

---
 data/theme/gnome-shell-sass/_colors.scss      |  8 +-
 data/theme/gnome-shell-sass/_common.scss      |  2 +-
 data/theme/gnome-shell-sass/_drawing.scss     | 80 +++++++++----------
 .../_high-contrast-colors.scss                |  9 +--
 .../theme/gnome-shell-sass/widgets/_a11y.scss | 10 +--
 .../theme/gnome-shell-sass/widgets/_base.scss |  2 +-
 .../gnome-shell-sass/widgets/_calendar.scss   | 18 ++---
 .../gnome-shell-sass/widgets/_check-box.scss  | 14 ++--
 .../gnome-shell-sass/widgets/_dialogs.scss    |  4 +-
 .../gnome-shell-sass/widgets/_ibus-popup.scss |  2 +-
 .../gnome-shell-sass/widgets/_keyboard.scss   | 16 ++--
 .../gnome-shell-sass/widgets/_login-lock.scss | 16 ++--
 .../widgets/_looking-glass.scss               |  4 +-
 .../widgets/_message-list.scss                |  2 +-
 .../theme/gnome-shell-sass/widgets/_misc.scss |  8 +-
 .../widgets/_notifications.scss               |  4 +-
 .../widgets/_quick-settings.scss              | 11 ++-
 .../gnome-shell-sass/widgets/_screenshot.scss | 10 +--
 .../gnome-shell-sass/widgets/_slider.scss     |  2 +-
 .../widgets/_switcher-popup.scss              |  2 +-
 .../gnome-shell-sass/widgets/_switches.scss   |  4 +-
 .../widgets/_workspace-thumbnails.scss        |  2 +-
 22 files changed, 114 insertions(+), 116 deletions(-)

diff --git a/data/theme/gnome-shell-sass/_colors.scss b/data/theme/gnome-shell-sass/_colors.scss
index d2f406b793d..a935791fea8 100644
--- a/data/theme/gnome-shell-sass/_colors.scss
+++ b/data/theme/gnome-shell-sass/_colors.scss
@@ -11,15 +11,13 @@ $base_color: if($variant == 'light', $light_1, $_dark_base_color);
 $bg_color: if($variant == 'light', $light_2, lighten($base_color, 5%));
 $fg_color: if($variant == 'light', transparentize(black, .2), white);
 
-$selected_fg_color: $light_1;
-$selected_bg_color: $blue_3;
-$selected_borders_color: if($variant== 'light', darken($selected_bg_color, 15%), darken($selected_bg_color, 20%));
+$accent_borders_color: if($variant== 'light', st-darken(-st-accent-color, 15%), st-darken(-st-accent-color, 20%));
 
 $borders_color: if($variant == 'light', transparentize($fg_color, .5), transparentize($fg_color, .9));
 $outer_borders_color: if($variant == 'light', rgba(255,255,255,0.8), lighten($bg_color, 5%));
 
-$link_color: if($variant == 'light', darken($selected_bg_color, 10%), lighten($selected_bg_color, 20%));
-$link_visited_color: if($variant == 'light', darken($selected_bg_color, 20%), lighten($selected_bg_color, 10%));
+$link_color: if($variant == 'light', st-darken(-st-accent-color, 10%), st-lighten(-st-accent-color, 20%));
+$link_visited_color: if($variant == 'light', st-darken(-st-accent-color, 20%), st-lighten(-st-accent-color, 10%));
 
 $warning_color: if($variant == 'light', $yellow_5, #cd9309);
 $error_color: if($variant == 'light', $red_3, $red_4);
diff --git a/data/theme/gnome-shell-sass/_common.scss b/data/theme/gnome-shell-sass/_common.scss
index 3e793bde577..1b021463410 100644
--- a/data/theme/gnome-shell-sass/_common.scss
+++ b/data/theme/gnome-shell-sass/_common.scss
@@ -115,7 +115,7 @@ stage {
   border-radius: $base_border_radius;
   padding: $base_padding*1.5 $base_padding*1.5;
   color: $fg_color;
-  selection-background-color: transparentize($selected_bg_color, 0.7);
+  selection-background-color: st-transparentize(-st-accent-color, 0.7);
   selected-color: $fg_color;
 
   @include entry(normal);
diff --git a/data/theme/gnome-shell-sass/_drawing.scss b/data/theme/gnome-shell-sass/_drawing.scss
index 80d59cb3344..b9fe5aba77c 100644
--- a/data/theme/gnome-shell-sass/_drawing.scss
+++ b/data/theme/gnome-shell-sass/_drawing.scss
@@ -25,7 +25,7 @@
 
 // entries
 
-@mixin entry($t, $fc:$selected_bg_color) {
+@mixin entry($t, $fc:-st-accent-color) {
 //
 // Entries drawing function
 //
@@ -47,7 +47,7 @@
   }
 
   @if $t==focus {
-    background-color: mix(transparentize($fg_color, 0.8), $selected_bg_color, 95%);
+    background-color: st-mix(transparentize($fg_color, 0.8), -st-accent-color, 95%);
     box-shadow: inset 0 0 0 2px $fc;
     color: $fg_color;
     &:hover {}
@@ -82,40 +82,40 @@
   // normal key
   @if $t==normal {
     color: $tc;
-    background-color: lighten($c, 3%);
+    background-color: st-lighten($c, 3%);
   }
 
   // focused key
   @if $t==focus {
     color: $tc;
-    background-color: mix(lighten($c, 3%), $selected_bg_color, 90%);
-    box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, 0.4);
+    background-color: st-mix(lighten($c, 3%), -st-accent-color, 90%);
+    box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, 0.4);
     &:hover {
-      background-color: mix(lighten($c, 8%), $selected_bg_color, 90%);
-      box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, 0.3);
+      background-color: st-mix(lighten($c, 8%), -st-accent-color, 90%);
+      box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, 0.3);
     }
     &:active {
-      background-color: mix(lighten($c, 10%), $selected_bg_color, 90%);
-      box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, 0.3);
+      background-color: st-mix(lighten($c, 10%), -st-accent-color, 90%);
+      box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, 0.3);
     }
   }
 
   // hover key
   @else if $t==hover {
     color: $tc;
-    background-color: lighten($c, 7%);
+    background-color: st-lighten($c, 7%);
   }
 
   // active key
   @else if $t==active {
     color: $tc;
-    background-color: lighten($c, 10%);
+    background-color: st-lighten($c, 10%);
   }
 
   // checked key
   @else if $t==checked {
     color: $tc;
-    background-color: lighten($c, 15%);
+    background-color: st-lighten($c, 15%);
   }
 
   // insensitive key
@@ -147,7 +147,7 @@
 
 @mixin button($t, $tc:$fg_color, $c:$bg_color, $flat: false) {
 
-  $button_bg_color: mix($tc, $c, $button_mix_factor);
+  $button_bg_color: st-mix($tc, $c, $button_mix_factor);
   transition-duration: 100ms;
 
   // normal button
@@ -165,7 +165,7 @@
   // hover button
   @else if $t==hover {
     color: $tc;
-    background-color: lighten($button_bg_color, 3%);
+    background-color: st-lighten($button_bg_color, 3%);
     @if $is_highcontrast {
       box-shadow: inset 0 0 0 1px $hc_inset_color !important;
     }
@@ -174,58 +174,58 @@
   // active button
   @else if $t==active {
     color: $tc;
-    background-color:  lighten($button_bg_color, 9%);
+    background-color: st-lighten($button_bg_color, 9%);
   }
 
   // checked button
   @else if $t==checked {
     color: $tc;
-    background-color: lighten($button_bg_color, 9%);
-    &:hover { background-color: lighten($button_bg_color, 12%);}
-    &:active { background-color: lighten($button_bg_color, 15%);}
+    background-color: st-lighten($button_bg_color, 9%);
+    &:hover { background-color: st-lighten($button_bg_color, 12%);}
+    &:active { background-color: st-lighten($button_bg_color, 15%);}
   }
 
   // focused button
   @if $t==focus {
     color: $tc;
-    background-color: mix($button_bg_color, $selected_bg_color, 90%);
-    box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, 0.4) !important;
+    background-color: st-mix($button_bg_color, -st-accent-color, 90%);
+    box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, 0.4) !important;
     &:hover {
-      background-color: mix(lighten($button_bg_color, 3%), $selected_bg_color, 90%);
-      box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, 0.3) !important;
+      background-color: st-mix(st-lighten($button_bg_color, 3%), -st-accent-color, 90%);
+      box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, 0.3) !important;
     }
     &:active {
-      background-color: mix(lighten($button_bg_color, 6%), $selected_bg_color, 90%);
-      box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, 0.3) !important;
+      background-color: st-mix(st-lighten($button_bg_color, 6%), -st-accent-color, 90%);
+      box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, 0.3) !important;
     }
   }
 
   // insensitive button
   @else if $t==insensitive {
-    color: transparentize($tc, 0.5);
-    background-color: transparentize($tc, .95);
+    color: st-transparentize($tc, 0.5);
+    background-color: st-transparentize($tc, .95);
   }
 
   // default/suggested button
   @else if $t==default {
-    background-color: $selected_bg_color;
-    color: $selected_fg_color;
+    background-color: -st-accent-color;
+    color: -st-accent-fg-color;
 
     &:focus {
-      box-shadow: inset 0 0 0 2px transparentize($selected_fg_color, .4) !important;
+      box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-fg-color, .4) !important;
     }
     &:hover, &:focus {
-      background-color: lighten($selected_bg_color, 5%);
-      color: lighten($selected_fg_color, 5%);
+      background-color: st-lighten(-st-accent-color, 5%);
+      color: st-lighten(-st-accent-fg-color, 5%);
     }
     &:active {
-      background-color: darken($selected_bg_color, 7%);
-      color: darken($selected_fg_color, 7%);
+      background-color: st-darken(-st-accent-color, 7%);
+      color: st-darken(-st-accent-fg-color, 7%);
     }
     &:insensitive {
       @include button(insensitive);
-      background-color: transparentize($selected_bg_color, .5);
-      color: transparentize($selected_fg_color, .5);
+      background-color: st-transparentize(-st-accent-color, .5);
+      color: st-transparentize(-st-accent-fg-color, .5);
     }
   }
 
@@ -237,7 +237,7 @@
     &:insensitive {
       @include button(insensitive);
       background-color: transparent;
-      color: transparentize($selected_fg_color, .5);
+      color: st-transparentize($tc, .5);
     }
   }
 }
@@ -266,8 +266,8 @@
     &:hover { background-color: transparentize($color, .75);}
   }
   &:drop {
-    border: 2px solid transparentize($selected_bg_color, .2); //already 2px transparent so no jumping
-    background-color: transparentize($selected_bg_color, .8);
+    border: 2px solid st-transparentize(-st-accent-color, .2); //already 2px transparent so no jumping
+    background-color: st-transparentize(-st-accent-color, .8);
   }
 }
 
@@ -300,8 +300,8 @@
     &:hover .overview-icon { background-color: transparentize($color, .75);}
   }
   &:drop .overview-icon {
-    border: 2px solid transparentize($selected_bg_color, .2); //already 2px transparent so no jumping
-    background-color: transparentize($selected_bg_color, .8);
+    border: 2px solid st-transparentize(-st-accent-color, .2); //already 2px transparent so no jumping
+    background-color: st-transparentize(-st-accent-color, .8);
   }
 }
 
diff --git a/data/theme/gnome-shell-sass/_high-contrast-colors.scss b/data/theme/gnome-shell-sass/_high-contrast-colors.scss
index 4d9aafdd7e9..39b0c3c72df 100644
--- a/data/theme/gnome-shell-sass/_high-contrast-colors.scss
+++ b/data/theme/gnome-shell-sass/_high-contrast-colors.scss
@@ -9,14 +9,11 @@ $base_color: if($variant == 'light', white, black);
 $bg_color: if($variant == 'light', darken($base_color, 10%), lighten($base_color, 10%));
 $fg_color: if($variant == 'light', transparentize(black, .2), white);
 
-$selected_fg_color: white;
-$selected_bg_color: $blue_3;
-
-$selected_borders_color: darken($selected_bg_color, 20%);
+$accent_borders_color: st-darken(-st-accent-color, 20%);
 $borders_color: if($variant == 'light', transparentize($fg_color, .5), transparentize($fg_color, .7));
 $outer_borders_color: $borders_color;
-$link_color: lighten($selected_bg_color,20%);
-$link_visited_color: lighten($selected_bg_color,10%);
+$link_color: st-lighten(-st-accent-color,20%);
+$link_visited_color: st-lighten(-st-accent-color,10%);
 
 $warning_color: if($variant == 'light', $yellow_5, #cd9309);
 $error_color: if($variant == 'light', $red_3, $red_4);
diff --git a/data/theme/gnome-shell-sass/widgets/_a11y.scss b/data/theme/gnome-shell-sass/widgets/_a11y.scss
index 31b5c4b7e28..0bbf185b6a7 100644
--- a/data/theme/gnome-shell-sass/widgets/_a11y.scss
+++ b/data/theme/gnome-shell-sass/widgets/_a11y.scss
@@ -3,8 +3,8 @@
   width: $ripple_size;
   height: $ripple_size;
   border-radius: $ripple_size * 0.5; // radius equals the size of the box to give us the curve
-  background-color: lighten(transparentize($selected_bg_color, 0.7), 30%);
-  box-shadow: 0 0 2px 2px lighten($selected_bg_color, 20%);
+  background-color: st-lighten(st-transparentize(-st-accent-color, 0.7), 30%);
+  box-shadow: 0 0 2px 2px st-lighten(-st-accent-color, 20%);
 }
 
 // Pointer accessibility notifications
@@ -12,13 +12,13 @@
   width: 60px;
   height: 60px;
   -pie-border-width: 3px;
-  -pie-border-color: $selected_bg_color;
-  -pie-background-color: lighten(transparentize($selected_bg_color, 0.7), 40%);
+  -pie-border-color: -st-accent-color;
+  -pie-background-color: st-lighten(st-transparentize(-st-accent-color, 0.7), 40%);
 }
 
 // Screen zoom/Magnifier
 .magnifier-zoom-region {
-  border: 2px solid $selected_bg_color;
+  border: 2px solid -st-accent-color;
 
   &.full-screen { border-width: 0; }
 }
diff --git a/data/theme/gnome-shell-sass/widgets/_base.scss b/data/theme/gnome-shell-sass/widgets/_base.scss
index 69ebb301a7a..a4e21d24598 100644
--- a/data/theme/gnome-shell-sass/widgets/_base.scss
+++ b/data/theme/gnome-shell-sass/widgets/_base.scss
@@ -3,7 +3,7 @@
   color: $link_color;
 
   &:hover {
-    color: lighten($link_color, 10%);
+    color: st-lighten($link_color, 10%);
   }
 }
 
diff --git a/data/theme/gnome-shell-sass/widgets/_calendar.scss b/data/theme/gnome-shell-sass/widgets/_calendar.scss
index df91dce5f32..bcaa3d0f450 100644
--- a/data/theme/gnome-shell-sass/widgets/_calendar.scss
+++ b/data/theme/gnome-shell-sass/widgets/_calendar.scss
@@ -77,16 +77,16 @@
 
     &:hover {background-color: $hover_bg_color;}
     &:focus {
-      background-color: mix($bg_color, $selected_bg_color, 80%);
-      color: $selected_fg_color;
-      box-shadow:inset 0 0 0 2px transparentize($selected_bg_color, 0.4);
+      background-color: st-mix($bg_color, -st-accent-color, 80%);
+      color: -st-accent-fg-color;
+      box-shadow:inset 0 0 0 2px st-transparentize(-st-accent-color, 0.4);
     }
 
     &:active,&:selected {
       color: $active_fg_color;
       background-color: $active_bg_color;
       &:focus {
-        background-color: mix($active_bg_color, $selected_bg_color, 80%);
+        background-color: st-mix($active_bg_color, -st-accent-color, 80%);
       }
     }
 
@@ -118,21 +118,21 @@
 
   // Today
   .calendar-today {
-    background-color: $selected_bg_color;
+    background-color: -st-accent-color;
     font-weight: 800;
-    color: $selected_fg_color !important;
+    color: -st-accent-fg-color !important;
 
     &:hover,&:focus {
-      background-color:lighten($selected_bg_color, 3%);
+      background-color: st-lighten(-st-accent-color, 3%);
       color: inherit;
     }
 
     &:active,&:selected {
-      background-color: $selected_bg_color;
+      background-color: -st-accent-color;
       color: inherit;
 
       &:hover,&:focus {
-        background-color:lighten($selected_bg_color, 3%);
+        background-color: st-lighten(-st-accent-color, 3%);
         color: inherit;
       }
     }
diff --git a/data/theme/gnome-shell-sass/widgets/_check-box.scss b/data/theme/gnome-shell-sass/widgets/_check-box.scss
index f18d6418cf2..956a59ee521 100644
--- a/data/theme/gnome-shell-sass/widgets/_check-box.scss
+++ b/data/theme/gnome-shell-sass/widgets/_check-box.scss
@@ -11,7 +11,7 @@
   &:focus StBin {
     // Trick due to St limitations. It needs a background to draw a box-shadow
     background-color: rgba(0, 0, 0, 0.01);
-    box-shadow: inset 0 0 0 2px transparentize($selected_bg_color, .65);
+    box-shadow: inset 0 0 0 2px st-transparentize(-st-accent-color, .65);
   }
 
   StIcon {
@@ -32,18 +32,18 @@
   }
 
   &:checked StIcon {
-    background-color: $selected_bg_color;
-    color: $selected_fg_color;
+    background-color: -st-accent-color;
+    color: -st-accent-fg-color;
     border-color: transparent;
   }
 
   &:checked:hover StIcon {
-    background-color: lighten($selected_bg_color, 5%);
-    color: lighten($selected_fg_color, 5%);
+    background-color: st-lighten(-st-accent-color, 5%);
+    color: st-lighten(-st-accent-fg-color, 5%);
   }
 
   &:checked:active StIcon {
-    background-color: darken($selected_bg_color, 7%);
-    color: darken($selected_fg_color, 7%);
+    background-color: st-darken(-st-accent-color, 7%);
+    color: st-darken(-st-accent-fg-color, 7%);
   }
 }
diff --git a/data/theme/gnome-shell-sass/widgets/_dialogs.scss b/data/theme/gnome-shell-sass/widgets/_dialogs.scss
index 98b3b8ce5dc..e039e6ee779 100644
--- a/data/theme/gnome-shell-sass/widgets/_dialogs.scss
+++ b/data/theme/gnome-shell-sass/widgets/_dialogs.scss
@@ -145,8 +145,8 @@
   border-radius: $base_border_radius*2;
   &:hover,&:focus { background-color: $hover_bg_color; }
   &:active { 
-    background-color: $selected_bg_color;
-    color: $selected_fg_color;
+    background-color: -st-accent-color;
+    color: -st-accent-fg-color;
   }
 }
 
diff --git a/data/theme/gnome-shell-sass/widgets/_ibus-popup.scss b/data/theme/gnome-shell-sass/widgets/_ibus-popup.scss
index 8cbaa9521b3..f858ea536a3 100644
--- a/data/theme/gnome-shell-sass/widgets/_ibus-popup.scss
+++ b/data/theme/gnome-shell-sass/widgets/_ibus-popup.scss
@@ -19,7 +19,7 @@
 .candidate-box {
   padding: $base_padding $base_padding*2 $base_padding $base_padding*2;
   border-radius: $base_border_radius;
-  &:selected { background-color: $selected_bg_color; color: $selected_fg_color; }
+  &:selected { background-color: -st-accent-color; color: -st-accent-fg-color; }
   &:hover { background-color: $hover_bg_color; color: $hover_fg_color; }
 }
 
diff --git a/data/theme/gnome-shell-sass/widgets/_keyboard.scss b/data/theme/gnome-shell-sass/widgets/_keyboard.scss
index 1dc6b953c64..05a8867c110 100644
--- a/data/theme/gnome-shell-sass/widgets/_keyboard.scss
+++ b/data/theme/gnome-shell-sass/widgets/_keyboard.scss
@@ -64,17 +64,17 @@ $default_key_bg_color: if($variant=='light', darken($key_bg_color, 11%), darken(
 
     // keys that may be latched: ctrl/alt/shift
     &:latched {
-      border-color: lighten($selected_bg_color, 5%);
-      background-color: $selected_bg_color;
+      border-color: st-lighten(-st-accent-color, 5%);
+      background-color: -st-accent-color;
     }
   }
 
   // enter key is suggested-action
   &.enter-key {
-    @include keyboard_key(normal, $selected_bg_color, $selected_fg_color);
-    &:hover { @include keyboard_key(hover, $selected_bg_color, $selected_fg_color);}
-    &:active {@include keyboard_key(active, $selected_bg_color, $selected_fg_color);}
-    &:checked {@include keyboard_key(checked, $selected_bg_color, $selected_fg_color);}
+    @include keyboard_key(normal, -st-accent-color, -st-accent-fg-color);
+    &:hover { @include keyboard_key(hover, -st-accent-color, -st-accent-fg-color);}
+    &:active {@include keyboard_key(active, -st-accent-color, -st-accent-fg-color);}
+    &:checked {@include keyboard_key(checked, -st-accent-color, -st-accent-fg-color);}
     border-radius: $key_border_radius;
     color: $osd_fg_color;
   }
@@ -129,8 +129,8 @@ $default_key_bg_color: if($variant=='light', darken($key_bg_color, 11%), darken(
 
 .emoji-panel {
   .keyboard-key:latched {
-    border-color: lighten($selected_bg_color, 5%);
-    background-color: $selected_bg_color;
+    border-color: st-lighten(-st-accent-color, 5%);
+    background-color: -st-accent-color;
   }
 }
 
diff --git a/data/theme/gnome-shell-sass/widgets/_login-lock.scss b/data/theme/gnome-shell-sass/widgets/_login-lock.scss
index cc67cb954f7..71b970623b7 100644
--- a/data/theme/gnome-shell-sass/widgets/_login-lock.scss
+++ b/data/theme/gnome-shell-sass/widgets/_login-lock.scss
@@ -75,8 +75,8 @@ $_gdm_dialog_width: 23em;
   color: darken($_gdm_fg,30%);
 
   &:focus, &:selected {
-    background-color: $selected_bg_color;
-    color: $selected_fg_color;
+    background-color: -st-accent-color;
+    color: -st-accent-fg-color;
   }
 }
 
@@ -114,7 +114,7 @@ $_gdm_dialog_width: 23em;
       background-color: darken($_gdm_fg, 30%);
     }
 
-    &:focus .login-dialog-timed-login-indicator { background-color: $selected_fg_color; }
+    &:focus .login-dialog-timed-login-indicator { background-color: -st-accent-fg-color; }
   }
 
   &:expanded .login-dialog-user-list-item {
@@ -127,14 +127,14 @@ $_gdm_dialog_width: 23em;
     }
 
     &:selected {
-      background-color: $selected_bg_color;
-      color: $selected_fg_color;
-      &:hover { background-color: lighten($selected_bg_color,5%); }
+      background-color: -st-accent-color;
+      color: -st-accent-fg-color;
+      &:hover { background-color: st-lighten(-st-accent-color,5%); }
     }
 
     &:logged-in {
       .user-widget .user-icon {
-        border-color: $selected_bg_color;
+        border-color: -st-accent-color;
       }
     }
   }
@@ -193,7 +193,7 @@ $_gdm_dialog_width: 23em;
   StButton#vhandle, StButton#hhandle {
     background-color: transparentize($bg_color,0.7);
     &:hover, &:focus { background-color: transparentize($bg_color,0.5); }
-    &:active { background-color: transparentize($selected_bg_color,0.5); }
+    &:active { background-color: st-transparentize(-st-accent-color,0.5); }
   }
 }
 
diff --git a/data/theme/gnome-shell-sass/widgets/_looking-glass.scss b/data/theme/gnome-shell-sass/widgets/_looking-glass.scss
index adcc372d67e..c6b3bf245da 100644
--- a/data/theme/gnome-shell-sass/widgets/_looking-glass.scss
+++ b/data/theme/gnome-shell-sass/widgets/_looking-glass.scss
@@ -57,8 +57,8 @@
 
   .shell-link {
     color: $link_color;
-    &:hover { color: lighten($link_color, 10%); }
-    &:active { color: darken($link_color, 10%); }
+    &:hover { color: st-lighten($link_color, 10%); }
+    &:active { color: st-darken($link_color, 10%); }
    }
 
   .actor-link {
diff --git a/data/theme/gnome-shell-sass/widgets/_message-list.scss b/data/theme/gnome-shell-sass/widgets/_message-list.scss
index d0e5d8551ff..1b65d43c685 100644
--- a/data/theme/gnome-shell-sass/widgets/_message-list.scss
+++ b/data/theme/gnome-shell-sass/widgets/_message-list.scss
@@ -55,7 +55,7 @@
     border-style: solid;
 
     &:focus {
-      border-color: transparentize($selected_bg_color, 0.4);
+      border-color: st-transparentize(-st-accent-color, 0.4);
     }
   }
 }
diff --git a/data/theme/gnome-shell-sass/widgets/_misc.scss b/data/theme/gnome-shell-sass/widgets/_misc.scss
index 0a98d570b90..e7fab02a175 100644
--- a/data/theme/gnome-shell-sass/widgets/_misc.scss
+++ b/data/theme/gnome-shell-sass/widgets/_misc.scss
@@ -1,7 +1,7 @@
 // Rubberband for select-area screenshots
 .select-area-rubberband {
-  background-color: transparentize($selected_bg_color,0.7);
-  border: 1px solid $selected_bg_color;
+  background-color: st-transparentize(-st-accent-color,0.7);
+  border: 1px solid -st-accent-color;
 }
 
 // User icon
@@ -48,6 +48,6 @@
 
 /* Tiled window previews */
 .tile-preview {
-  background-color: transparentize($selected_bg_color,0.5);
-  border: 1px solid $selected_bg_color;
+  background-color: st-transparentize(-st-accent-color,0.5);
+  border: 1px solid -st-accent-color;
 }
diff --git a/data/theme/gnome-shell-sass/widgets/_notifications.scss b/data/theme/gnome-shell-sass/widgets/_notifications.scss
index 86480a87419..2f339c37822 100644
--- a/data/theme/gnome-shell-sass/widgets/_notifications.scss
+++ b/data/theme/gnome-shell-sass/widgets/_notifications.scss
@@ -29,8 +29,8 @@ $notification_banner_radius: $base_border_radius*1.5;
   width: 1.6em;
   -shell-counter-overlap-x: 3px;
   -shell-counter-overlap-y: 3px;
-  background-color: $selected_bg_color;
-  color: $selected_fg_color;
+  background-color: -st-accent-color;
+  color: -st-accent-fg-color;
   border: 2px solid $fg_color;
   box-shadow: 0 2px 2px rgba(0,0,0,0.5);
   border-radius: 0.9em; // should be 0.8 but whatever; wish I could do 50%;
diff --git a/data/theme/gnome-shell-sass/widgets/_quick-settings.scss b/data/theme/gnome-shell-sass/widgets/_quick-settings.scss
index d6b4e5a3d59..71cf10e3f1f 100644
--- a/data/theme/gnome-shell-sass/widgets/_quick-settings.scss
+++ b/data/theme/gnome-shell-sass/widgets/_quick-settings.scss
@@ -21,7 +21,7 @@
 }
 
 .quick-toggle {
-  &:checked { @include button(default, $c:$selected_bg_color); }
+  &:checked { @include button(default); }
 
   & > StBoxLayout { spacing: $base_padding*1.5; }
 
@@ -61,8 +61,8 @@
     border-width: 0;
 
     &:checked {
-      @include button(default, $c:$selected_bg_color);
-      border-color: $selected_borders_color;
+      @include button(default);
+      border-color: $accent_borders_color;
     }
 
     &:ltr {
@@ -108,7 +108,10 @@
       padding: 1.5 * $base_padding;
       background-color: transparentize($fg_color, 0.8);
 
-      &.active { background-color: $selected_bg_color;}
+      &.active {
+        color: -st-accent-fg-color;
+        background-color: -st-accent-color;
+      }
     }
 
     & .title {
diff --git a/data/theme/gnome-shell-sass/widgets/_screenshot.scss b/data/theme/gnome-shell-sass/widgets/_screenshot.scss
index 150f273b425..f82b802b5b1 100644
--- a/data/theme/gnome-shell-sass/widgets/_screenshot.scss
+++ b/data/theme/gnome-shell-sass/widgets/_screenshot.scss
@@ -166,18 +166,18 @@ $screenshot_ui_button_red: $error_color;
 .screenshot-ui-window-selector-window {
   &:hover {
     .screenshot-ui-window-selector-window-border {
-      border-color: darken($selected_bg_color, 15%);
+      border-color: st-darken(-st-accent-color, 15%);
     }
   }
   &:checked {
     .screenshot-ui-window-selector-window-border {
-      border-color: $selected_bg_color;
-      background-color: transparentize($selected_bg_color, 0.8);
+      border-color: -st-accent-color;
+      background-color: st-transparentize(-st-accent-color, 0.8);
     }
 
     .screenshot-ui-window-selector-check {
-      color: $selected_fg_color;
-      background-color: $selected_bg_color;
+      color: -st-accent-fg-color;
+      background-color: -st-accent-color;
     }
   }
 }
diff --git a/data/theme/gnome-shell-sass/widgets/_slider.scss b/data/theme/gnome-shell-sass/widgets/_slider.scss
index 500249aa52d..755a6bc872a 100644
--- a/data/theme/gnome-shell-sass/widgets/_slider.scss
+++ b/data/theme/gnome-shell-sass/widgets/_slider.scss
@@ -9,7 +9,7 @@ $slider_size: 16px;
   -barlevel-border-width: 2px; 
   -barlevel-border-color: transparent; // trough border color
   // fill style
-  -barlevel-active-background-color: $selected_bg_color;
+  -barlevel-active-background-color: -st-accent-color;
   -barlevel-active-border-color: transparent;
   // overfill style (red in this case)
   -barlevel-overdrive-color: $destructive_color;
diff --git a/data/theme/gnome-shell-sass/widgets/_switcher-popup.scss b/data/theme/gnome-shell-sass/widgets/_switcher-popup.scss
index 5136c3cfe19..b0e5c2e7363 100644
--- a/data/theme/gnome-shell-sass/widgets/_switcher-popup.scss
+++ b/data/theme/gnome-shell-sass/widgets/_switcher-popup.scss
@@ -70,5 +70,5 @@ $switcher_padding: $base_padding*2;
 
 // Window cycler highlight
 .cycler-highlight {
-  border: 5px solid $selected_bg_color;
+  border: 5px solid -st-accent-color;
 }
diff --git a/data/theme/gnome-shell-sass/widgets/_switches.scss b/data/theme/gnome-shell-sass/widgets/_switches.scss
index 489cb0df85f..87e1efda223 100644
--- a/data/theme/gnome-shell-sass/widgets/_switches.scss
+++ b/data/theme/gnome-shell-sass/widgets/_switches.scss
@@ -33,10 +33,10 @@ $switch_icon_padding: 0.35em;
   }
 
   &:checked {
-    background: $selected_bg_color;
+    background: -st-accent-color;
 
     @if $is_highcontrast {
-      color: $selected_fg_color;
+      color: -st-accent-fg-color;
     }
 
     .handle {
diff --git a/data/theme/gnome-shell-sass/widgets/_workspace-thumbnails.scss b/data/theme/gnome-shell-sass/widgets/_workspace-thumbnails.scss
index ecbbc4113dd..b4beede1f74 100644
--- a/data/theme/gnome-shell-sass/widgets/_workspace-thumbnails.scss
+++ b/data/theme/gnome-shell-sass/widgets/_workspace-thumbnails.scss
@@ -27,6 +27,6 @@
 
 // selected indicator
 .workspace-thumbnail-indicator {
-  border: 3px solid $selected_bg_color;
+  border: 3px solid -st-accent-color;
   border-radius: $base_border_radius;
 }
-- 
GitLab

